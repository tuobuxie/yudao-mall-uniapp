import{B as a,s as e,v as s,c as t,o,r as d,e as r,f as c,w as l,u as n,a5 as i,S as u,j as f,g as m,y as p,k as g,p as h,t as _,l as b,m as y,F as k,an as w,ao as v,ah as R,i as x,G as I,q as S,H as N}from"./index-Ch_jkemp.js";import{_ as C}from"./s-goods-item.DcngbUKh.js";import{_ as j}from"./s-select-groupon-sku.sp-2nGie.js";import{_ as $}from"./s-empty.DdU54__M.js";import{S as A}from"./s-layout.Ckk_oEQ_.js";import{f as T,u as P}from"./useGoods.CmR2wUi_.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./su-number-box.XmnqyQW5.js";const H=z({__name:"detail",setup(z){a((a=>({c3fe3e9e:n(H)})));const H=e.$url.css("/static/img/shop/user/withdraw_bg.png"),D=2*e.$platform.device.statusBarHeight,B=s({data:{},goodsId:0,goodsInfo:{},showSelectSku:!1,selectedSkuPrice:{},activity:{},grouponId:0,grouponNum:0,grouponAction:"create",combinationHeadId:null,loading:!0}),E=t((()=>{var a;return w(B.data)?{}:e.$platform.share.getShareInfo({title:B.data.headRecord.spuName,image:e.$url.cdn(B.data.headRecord.picUrl),desc:null==(a=B.data.goods)?void 0:a.subtitle,params:{page:v.GROUPON_DETAIL.value,query:B.data.headRecord.id}},{type:"groupon",title:B.data.headRecord.spuName,image:e.$url.cdn(B.data.headRecord.picUrl),price:T(B.data.headRecord.combinationPrice),grouponNum:B.data.headRecord.userSize})}));function U(a){e.$router.go("/pages/order/detail",{id:a})}function G(){B.grouponAction="create",B.grouponId=0,B.showSelectSku=!0}function M(a){B.selectedSkuPrice=a}function O(a){e.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",combinationActivityId:B.activity.id,combinationHeadId:B.combinationHeadId,items:[{skuId:a.id,count:a.count}]})})}const q=t((()=>P(B.data.headRecord.expireTime)));function F(){R()}return o((a=>{!async function(a){const{code:e,data:s}=await i.getCombinationRecordDetail(a);if(0===e){B.data=s;const a=Number(B.data.headRecord.userSize-B.data.headRecord.userCount);B.remainNumber=a>0?a:0;const{data:e}=await i.getCombinationActivity(s.headRecord.activityId);B.activity=e,B.grouponNum=e.userSize;const{data:t}=await u.getSpuDetail(e.spuId);B.goodsId=t.id,e.products.forEach((a=>{t.price=Math.min(t.price,a.combinationPrice)})),B.goodsInfo=t,t.skus.forEach((a=>{const s=e.products.find((e=>e.skuId===a.id));s?a.price=s.combinationPrice:a.stock=0}))}else B.data=null;B.loading=!1}(a.id)})),(a,s)=>{const t=x,o=d(r("s-goods-item"),C),i=I,u=S,v=N,R=d(r("s-select-groupon-sku"),j),T=d(r("s-empty"),$),P=d(r("s-layout"),A);return f(),c(P,{title:"拼团详情",class:"detail-wrap",navbar:B.data&&!B.loading?"inner":"normal",onShareAppMessage:E.value},{default:l((()=>[B.loading?(f(),c(t,{key:0})):m("",!0),B.data&&!B.loading?(f(),c(t,{key:1},{default:l((()=>[B.data.headRecord?(f(),c(t,{key:0,class:"recharge-box",style:p([{marginTop:"-"+Number(D+88)+"rpx",paddingTop:Number(D+108)+"rpx"}])},{default:l((()=>[g(o,{class:"goods-box",img:B.data.headRecord.picUrl,title:B.data.headRecord.spuName,price:B.data.headRecord.combinationPrice,priceColor:"#E1212B",onClick:s[0]||(s[0]=a=>n(e).$router.go("/pages/goods/groupon",{id:B.data.headRecord.activityId})),style:p([{top:Number(D+108)+"rpx"}])},{groupon:l((()=>[g(t,{class:"ss-flex"},{default:l((()=>[g(t,{class:"sales-title"},{default:l((()=>[h(_(B.data.headRecord.userSize)+"人团",1)])),_:1}),g(t,{class:"num-title ss-m-l-20"},{default:l((()=>[h("已拼"+_(B.data.headRecord.userCount)+"件",1)])),_:1})])),_:1})])),_:1},8,["img","title","price","style"])])),_:1},8,["style"])):m("",!0),g(t,{class:"countdown-box detail-card ss-p-t-44 ss-flex-col ss-col-center"},{default:l((()=>[1===B.data.headRecord.status?(f(),c(t,{key:0},{default:l((()=>[B.data.orderId?(f(),c(t,{key:0},{default:l((()=>[g(t,{class:"countdown-title ss-flex"},{default:l((()=>[g(i,{class:"cicon-check-round"}),h(" 恭喜您~拼团成功 ")])),_:1})])),_:1})):(f(),c(t,{key:1},{default:l((()=>[g(t,{class:"countdown-title ss-flex"},{default:l((()=>[g(i,{class:"cicon-info"}),h(" 抱歉~该团已满员 ")])),_:1})])),_:1}))])),_:1})):m("",!0),2===B.data.headRecord.status?(f(),c(t,{key:1},{default:l((()=>[g(t,{class:"countdown-title ss-flex"},{default:l((()=>[g(i,{class:"cicon-info"}),h(" "+_(B.data.orderId?"拼团超时,已自动退款":"该团已解散"),1)])),_:1})])),_:1})):m("",!0),0===B.data.headRecord.status?(f(),c(t,{key:2},{default:l((()=>[B.data.headRecord.expireTime<=(new Date).getTime()?(f(),c(t,{key:0},{default:l((()=>[g(t,{class:"countdown-title ss-flex"},{default:l((()=>[g(i,{class:"cicon-info"}),h(" 拼团已结束,请关注下次活动 ")])),_:1})])),_:1})):(f(),c(t,{key:1,class:"countdown-title ss-flex"},{default:l((()=>[h(" 还差 "),g(t,{class:"num"},{default:l((()=>[h(_(B.data.headRecord.userSize-B.data.headRecord.userCount)+"人",1)])),_:1}),h(" 拼团成功 "),g(t,{class:"ss-flex countdown-time"},{default:l((()=>[g(t,{class:"countdown-h ss-flex ss-row-center"},{default:l((()=>[h(_(q.value.h),1)])),_:1}),g(t,{class:"ss-m-x-4"},{default:l((()=>[h(":")])),_:1}),g(t,{class:"countdown-num ss-flex ss-row-center"},{default:l((()=>[h(_(q.value.m),1)])),_:1}),g(t,{class:"ss-m-x-4"},{default:l((()=>[h(":")])),_:1}),g(t,{class:"countdown-num ss-flex ss-row-center"},{default:l((()=>[h(_(q.value.s),1)])),_:1})])),_:1})])),_:1}))])),_:1})):m("",!0),g(t,{class:"ss-m-t-60 ss-flex ss-flex-wrap ss-row-center"},{default:l((()=>[g(t,{class:"header-avatar ss-m-r-24 ss-m-b-20"},{default:l((()=>[g(u,{src:n(e).$url.cdn(B.data.headRecord.avatar)||n(e).$url.static("/static/img/shop/default_avatar.png"),class:"avatar-img"},null,8,["src"]),g(t,{class:"header-tag ss-flex ss-col-center ss-row-center"},{default:l((()=>[h("团长")])),_:1})])),_:1}),(f(!0),b(k,null,y(B.data.memberRecords,(a=>(f(),c(t,{class:"header-avatar ss-m-r-24 ss-m-b-20",key:a.id},{default:l((()=>[g(u,{src:n(e).$url.cdn(a.avatar)||n(e).$url.static("/static/img/shop/default_avatar.png"),class:"avatar-img"},null,8,["src"]),"1"==a.is_leader?(f(),c(t,{key:0,class:"header-tag ss-flex ss-col-center ss-row-center"},{default:l((()=>[h(" 团长 ")])),_:1})):m("",!0)])),_:2},1024)))),128)),(f(!0),b(k,null,y(B.remainNumber,(a=>(f(),c(t,{class:"default-avatar ss-m-r-24 ss-m-b-20",key:a},{default:l((()=>[g(u,{src:n(e).$url.static("/static/img/shop/avatar/unknown.png"),class:"avatar-img"},null,8,["src"])])),_:2},1024)))),128))])),_:1})])),_:1}),1===B.data.headRecord.status||2===B.data.headRecord.status?(f(),c(t,{key:1,class:"ss-m-t-40 ss-flex ss-row-center"},{default:l((()=>[B.data.orderId?(f(),c(v,{key:0,class:"ss-reset-button order-btn",onClick:s[1]||(s[1]=a=>U(B.data.orderId))},{default:l((()=>[h(" 查看订单 ")])),_:1})):(f(),c(v,{key:1,class:"ss-reset-button join-btn",onClick:G},{default:l((()=>[h(" 我要开团 ")])),_:1}))])),_:1})):m("",!0),0===B.data.headRecord.status?(f(),c(t,{key:2,class:"ss-m-t-40 ss-flex ss-row-center"},{default:l((()=>[B.data.headRecord.expireTime<=(new Date).getTime()?(f(),c(t,{key:0},{default:l((()=>[B.data.orderId?(f(),c(v,{key:0,class:"ss-reset-button join-btn",onClick:s[2]||(s[2]=a=>U(B.data.orderId))},{default:l((()=>[h(" 查看订单 ")])),_:1})):(f(),c(v,{key:1,class:"ss-reset-button disabled-btn",disabled:"",onClick:s[3]||(s[3]=a=>U(B.data.orderId))},{default:l((()=>[h(" 去参团 ")])),_:1}))])),_:1})):(f(),c(t,{key:1,class:"ss-flex ss-row-center"},{default:l((()=>[B.data.orderId?(f(),c(t,{key:0},{default:l((()=>[g(v,{class:"ss-reset-button join-btn",disabled:q.value.ms<=0,onClick:F},{default:l((()=>[h(" 邀请好友来拼团 ")])),_:1},8,["disabled"])])),_:1})):(f(),c(t,{key:1},{default:l((()=>[g(v,{class:"ss-reset-button join-btn",disabled:q.value.ms<=0,onClick:s[4]||(s[4]=a=>(B.grouponAction="join",B.grouponId=B.data.headRecord.activityId,B.combinationHeadId=B.data.headRecord.id,B.grouponNum=B.data.headRecord.userSize,void(B.showSelectSku=!0)))},{default:l((()=>[h(" 立即参团 ")])),_:1},8,["disabled"])])),_:1}))])),_:1}))])),_:1})):m("",!0),n(w)(B.goodsInfo)?m("",!0):(f(),c(t,{key:3},{default:l((()=>[g(R,{show:B.showSelectSku,goodsInfo:B.goodsInfo,grouponAction:B.grouponAction,grouponNum:B.grouponNum,onBuy:O,onChange:M,onClose:s[5]||(s[5]=a=>B.showSelectSku=!1)},null,8,["show","goodsInfo","grouponAction","grouponNum"])])),_:1}))])),_:1})):m("",!0),B.data||B.loading?m("",!0):(f(),c(T,{key:2,icon:"/static/goods-empty.png"}))])),_:1},8,["navbar","onShareAppMessage"])}}},[["__scopeId","data-v-b0ff9158"]]);export{H as default};
