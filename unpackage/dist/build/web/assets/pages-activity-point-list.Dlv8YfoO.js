import{v as t,aj as o,c as e,s,r,e as a,j as l,f as i,w as p,l as d,F as u,m as n,y,k as c,u as g,p as m,t as b,g as f,E as h,a7 as v,H as C,i as x,S as _,X as k,aE as R,o as B,a8 as S,z as T}from"./index-Ch_jkemp.js";import{_ as L}from"./s-goods-column.ww3VogJ9.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as I}from"./s-empty.DdU54__M.js";import{_ as F}from"./uni-load-more.C8hvkNiT.js";import{S as $}from"./s-layout.Ckk_oEQ_.js";import"./useGoods.CmR2wUi_.js";const j=w({__name:"s-point-card",props:{property:{type:Object,default:()=>({})}},setup(k,{expose:R}){const B="oneColBigImg",S="twoCol",T="oneColSmallImg",w=t({spuList:[],leftSpuList:[],rightSpuList:[],property:{layoutType:"oneColBigImg",fields:{name:{show:!0,color:"#000"},introduction:{show:!0,color:"#999"},price:{show:!0,color:"#ff3000"},marketPrice:{show:!0,color:"#c4c4c4"},salesCount:{show:!0,color:"#c4c4c4"},stock:{show:!0,color:"#c4c4c4"}},badge:{show:!1,imgUrl:""},btnBuy:{type:"text",text:"立即兑换",bgBeginColor:"#FF6000",bgEndColor:"#FE832A",imgUrl:""},borderRadiusTop:8,borderRadiusBottom:8,space:8,style:{bgType:"color",bgColor:"",marginLeft:8,marginRight:8,marginBottom:8}}}),I=k;o((()=>I.property),(t=>{w.property={...w.property,...t}}),{immediate:!0,deep:!0});const{marginLeft:F,marginRight:$}=w.property.styles||{},j=e((()=>"text"===w.property.btnBuy.type?{background:`linear-gradient(to right, ${w.property.btnBuy.bgBeginColor}, ${w.property.btnBuy.bgEndColor})`}:"img"===w.property.btnBuy.type?{width:"54rpx",height:"54rpx",background:`url(${s.$url.cdn(w.property.btnBuy.imgUrl)}) no-repeat`,backgroundSize:"100% 100%"}:void 0));let A=0,z=0,E=0;function P(t=0,o="left"){w.spuList[A]&&("left"===o&&(z+=t),"right"===o&&(E+=t),z<=E?w.leftSpuList.push(w.spuList[A]):w.rightSpuList.push(w.spuList[A]),A++)}async function W(t){const{data:o}=await _.getSpuDetail(t);return o}return R({concatActivity:async function(t){if(!h(t)){for(const o of t)w.spuList.push(await W(o.spuId));t.forEach((t=>{const o=w.spuList.find((o=>t.spuId===o.id));o&&(o.pointStock=t.stock,o.pointTotalStock=t.totalStock,o.point=t.point,o.pointPrice=t.price,o.activityId=t.id,o.activityType=v.POINT.type)})),w.property.layoutType===S&&P()}},getActivityCount:function(){return w.spuList.length},calculateGoodsColumn:P}),(t,o)=>{const e=C,h=r(a("s-goods-column"),L),v=x;return l(),i(v,null,{default:p((()=>[w.property.layoutType===B&&w.spuList.length?(l(),i(v,{key:0,class:"goods-sl-box"},{default:p((()=>[(l(!0),d(u,null,n(w.spuList,(t=>(l(),i(v,{class:"goods-box",key:t.id,style:y([{marginBottom:2*w.property.space+"rpx"}])},{default:p((()=>{var o;return[c(h,{class:"",size:"sl",goodsFields:w.property.fields,tagStyle:w.property.badge,data:t,titleColor:null==(o=w.property.fields.name)?void 0:o.color,subTitleColor:w.property.fields.introduction.color,topRadius:w.property.borderRadiusTop,bottomRadius:w.property.borderRadiusBottom,onClick:o=>g(s).$router.go("/pages/goods/point",{id:t.activityId})},{cart:p((()=>[c(e,{class:"ss-reset-button cart-btn",style:y([j.value])},{default:p((()=>[m(b("text"===w.property.btnBuy.type?w.property.btnBuy.text:""),1)])),_:1},8,["style"])])),_:2},1032,["goodsFields","tagStyle","data","titleColor","subTitleColor","topRadius","bottomRadius","onClick"])]})),_:2},1032,["style"])))),128))])),_:1})):f("",!0),w.property.layoutType===T&&w.spuList.length?(l(),i(v,{key:1,class:"goods-lg-box"},{default:p((()=>[(l(!0),d(u,null,n(w.spuList,(t=>(l(),i(v,{class:"goods-box",style:y([{marginBottom:w.property.space+"px"}]),key:t.id},{default:p((()=>{var o;return[c(h,{class:"goods-card",size:"lg",goodsFields:w.property.fields,data:t,tagStyle:w.property.badge,titleColor:null==(o=w.property.fields.name)?void 0:o.color,subTitleColor:w.property.fields.introduction.color,topRadius:w.property.borderRadiusTop,bottomRadius:w.property.borderRadiusBottom,onClick:o=>g(s).$router.go("/pages/goods/point",{id:t.activityId})},{cart:p((()=>[c(e,{class:"ss-reset-button cart-btn",style:y([j.value])},{default:p((()=>[m(b("text"===w.property.btnBuy.type?w.property.btnBuy.text:""),1)])),_:1},8,["style"])])),_:2},1032,["goodsFields","data","tagStyle","titleColor","subTitleColor","topRadius","bottomRadius","onClick"])]})),_:2},1032,["style"])))),128))])),_:1})):f("",!0),w.property.layoutType===S&&w.spuList.length?(l(),i(v,{key:2,class:"goods-md-wrap ss-flex ss-flex-wrap ss-col-top"},{default:p((()=>[c(v,{class:"goods-list-box"},{default:p((()=>[(l(!0),d(u,null,n(w.leftSpuList,(t=>(l(),i(v,{class:"left-list",style:y([{paddingRight:w.property.space+"rpx",marginBottom:w.property.space+"px"}]),key:t.id},{default:p((()=>{var r;return[c(h,{class:"goods-md-box",size:"md",goodsFields:w.property.fields,tagStyle:w.property.badge,data:t,titleColor:null==(r=w.property.fields.name)?void 0:r.color,subTitleColor:w.property.fields.introduction.color,topRadius:w.property.borderRadiusTop,bottomRadius:w.property.borderRadiusBottom,titleWidth:330-g(F)-g($),onClick:o=>g(s).$router.go("/pages/goods/point",{id:t.activityId}),onGetHeight:o[0]||(o[0]=t=>P(t,"left"))},{cart:p((()=>[c(e,{class:"ss-reset-button cart-btn",style:y([j.value])},{default:p((()=>[m(b("text"===w.property.btnBuy.type?w.property.btnBuy.text:""),1)])),_:1},8,["style"])])),_:2},1032,["goodsFields","tagStyle","data","titleColor","subTitleColor","topRadius","bottomRadius","titleWidth","onClick"])]})),_:2},1032,["style"])))),128))])),_:1}),c(v,{class:"goods-list-box"},{default:p((()=>[(l(!0),d(u,null,n(w.rightSpuList,(t=>(l(),i(v,{class:"right-list",style:y([{paddingLeft:w.property.space+"rpx",marginBottom:w.property.space+"px"}]),key:t.id},{default:p((()=>{var r;return[c(h,{class:"goods-md-box",size:"md",goodsFields:w.property.fields,tagStyle:w.property.badge,data:t,titleColor:null==(r=w.property.fields.name)?void 0:r.color,subTitleColor:w.property.fields.introduction.color,topRadius:w.property.borderRadiusTop,bottomRadius:w.property.borderRadiusBottom,titleWidth:330-g(F)-g($),onClick:o=>g(s).$router.go("/pages/goods/point",{id:t.activityId}),onGetHeight:o[1]||(o[1]=t=>P(t,"right"))},{cart:p((()=>[c(e,{class:"ss-reset-button cart-btn",style:y([j.value])},{default:p((()=>[m(b("text"===w.property.btnBuy.type?w.property.btnBuy.text:""),1)])),_:1},8,["style"])])),_:2},1032,["goodsFields","tagStyle","data","titleColor","subTitleColor","topRadius","bottomRadius","titleWidth","onClick"])]})),_:2},1032,["style"])))),128))])),_:1})])),_:1})):f("",!0)])),_:1})}}},[["__scopeId","data-v-33c76d65"]]),A={__name:"list",setup(o){const{safeAreaInsets:e,safeArea:d}=s.$platform.device,u=2*s.$platform.device.statusBarHeight,n=2*(d.height+e.bottom)+u-s.$platform.navbar-350,g=k(),m=t({pageNo:1,pageSize:5}),b=k(0),h=k(0),v=k("");async function C(){v.value="loading";const{data:t}=await S.getPointActivityPage(m);await g.value.concatActivity(t.list),h.value=g.value.getActivityCount(),b.value=t.total,v.value=h.value<b.value?"more":"noMore"}function x(){"noMore"!==v.value&&(m.pageNo+=1,C())}return R((()=>{x()})),B((()=>{C()})),(t,o)=>{const e=r(a("s-point-card"),j),s=r(a("s-empty"),I),d=r(a("uni-load-more"),F),u=T;return l(),i($,{title:"积分商城",navbar:"normal",leftWidth:0,rightWidth:0},{default:p((()=>[c(u,{class:"scroll-box",style:y({height:n+"rpx"}),"scroll-y":"true","scroll-with-animation":!1,"enable-back-to-top":!0},{default:p((()=>[c(e,{ref_key:"sPointCardRef",ref:g,class:"ss-p-x-20 ss-m-t-20"},null,512),0===b.value?(l(),i(s,{key:0,icon:"/static/goods-empty.png",text:"暂无积分商品"})):f("",!0),b.value>0?(l(),i(d,{key:1,status:v.value,"content-text":{contentdown:"上拉加载更多"},onClick:x},null,8,["status"])):f("",!0)])),_:1},8,["style"])])),_:1})}}};export{A as default};
