import{W as e,j as t,f as s,w as a,k as l,T as n,g as o,y as i,p as r,t as u,i as c,B as d,s as f,X as g,c as p,v,aE as m,o as h,r as _,e as y,u as x,a6 as k,b5 as b,aq as w,be as $,l as T,m as A,F as S,q as D,V as C,z as I,A as j,a9 as N,U as B,G as W,H as E}from"./index-Ch_jkemp.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as R}from"./s-goods-column.ww3VogJ9.js";import{_ as Y}from"./uni-load-more.C8hvkNiT.js";import{S as P}from"./s-layout.Ckk_oEQ_.js";import{u as z}from"./useGoods.CmR2wUi_.js";const F=M({name:"AiProgress",components:{},props:{percentage:{type:[Number,String],required:!0},textInside:{type:Boolean,default:!1},strokeWidth:{type:[Number,String],default:6},duration:{type:[Number,String],default:2e3},isAnimate:{type:Boolean,default:!1},bgColor:{type:String,default:"linear-gradient(90deg, var(--ui-BG-Main) 0%, var(--ui-BG-Main-gradient) 100%)"},noData:{type:Boolean,default:!1},lineData:{type:Boolean,default:!1},inBgColor:{type:String,default:"#ebeef5"}},data:()=>({width:0,timer:null,containerWidth:0,contentWidth:0}),methods:{start(){if(this.isAnimate){this.$nextTick((()=>{let e=this.$refs.progressContainer.$el,t=this.$refs.progressContent.$el,s=window.getComputedStyle(e,null).width.replace("px","")*(1*this.percentage/100);t.style.width=s.toFixed(2)+"px",t.style.transition=`width ${this.duration/1e3}s ease`}));const t=e().in(this).selectAll("#container");e().in(this).selectAll("#content"),t.boundingClientRect().exec((e=>{this.contentWidth=1*e[0][0].width*(1*this.percentage/100).toFixed(2)+"px"}))}}},mounted(){this.$nextTick((()=>{this.start()}))},created(){},filters:{},computed:{},watch:{},directives:{}},[["render",function(e,d,f,g,p,v){const m=c;return t(),s(m,null,{default:a((()=>[f.lineData?(t(),s(m,{key:0,class:"flex a-center content"},{default:a((()=>[l(m,null,{default:a((()=>[n(e.$slots,"content",{},void 0,!0)])),_:3})])),_:3})):o("",!0),l(m,{class:"flex a-center",style:{"padding-right":"10rpx"}},{default:a((()=>[l(m,{class:"progress-container",id:"container",ref:"progressContainer",style:i({background:f.inBgColor})},{default:a((()=>[f.isAnimate?(t(),s(m,{key:0,class:"progress-content flex j-end",id:"content",ref:"progressContent",style:i({height:f.strokeWidth+"px",background:f.bgColor,width:p.contentWidth,transition:`width ${f.duration/1e3}s ease`})},{default:a((()=>[f.textInside&&!f.noData?(t(),s(m,{key:0,class:"textInside flex a-center j-center"},{default:a((()=>[l(m,{class:"text"},{default:a((()=>[r(u(f.percentage)+"%",1)])),_:1})])),_:1})):o("",!0)])),_:1},8,["style"])):o("",!0),f.isAnimate?o("",!0):(t(),s(m,{key:1,class:"progress-content flex j-end",style:i({width:f.percentage+"%",height:f.strokeWidth+"px",background:f.bgColor})},{default:a((()=>[f.textInside&&!f.noData?(t(),s(m,{key:0,class:"textInside flex a-center j-center"},{default:a((()=>[l(m,{class:"text"},{default:a((()=>[r(u(f.percentage)+"%",1)])),_:1})])),_:1})):o("",!0)])),_:1},8,["style"]))])),_:1},8,["style"]),l(m,null,{default:a((()=>[f.textInside||f.lineData||f.noData||f.isAnimate?o("",!0):(t(),s(m,{key:0,class:"percentage"},{default:a((()=>[r(u(f.percentage)+"% ",1)])),_:1}))])),_:1})])),_:1})])),_:3})}],["__scopeId","data-v-818607e7"]]),G=M({__name:"list",setup(e){d((e=>({"83dad2b8":x(U)})));const{safeAreaInsets:n,safeArea:M}=f.$platform.device,G=2*f.$platform.device.statusBarHeight,q=2*(M.height+n.bottom)+G-f.$platform.navbar-350,U=f.$url.css("/static/img/shop/goods/seckill-header.png"),H={name:{show:!0},introduction:{show:!0},price:{show:!0},marketPrice:{show:!0}},L=g([]),V=g(""),X=e=>{$((()=>V.value=`timeItem${e}`))},Z=g(0),J=p((()=>L.value[Z.value])),K=(e,t)=>{Z.value=e,Q.pageNo=1,Q.configId=t,te.value=[],ae()},O=p((()=>{var e;const t=null==(e=J.value)?void 0:e.endTime;if(t)return z(`${b().format("YYYY-MM-DD")} ${t}`)})),Q=v({configId:0,pageNo:1,pageSize:5}),ee=g(0),te=g([]),se=g("");async function ae(){se.value="loading";const{data:e}=await k.getSeckillActivityPage(Q);e.list.forEach((e=>{e.percent=parseInt(100*(e.totalStock-e.stock)/e.totalStock)})),te.value=te.value.concat(...e.list),ee.value=e.total,se.value=te.value.length<ee.value?"more":"noMore"}function le(){"noMore"!==se.value&&(Q.pageNo+=1,ae())}return m((()=>le())),h((async()=>{await(async()=>{const{data:e}=await k.getSeckillConfigList(),t=b(),s=t.format("YYYY-MM-DD"),a=g([]);e.forEach(((e,l)=>{const n=b(`${s} ${e.startTime}`),o=b(`${s} ${e.endTime}`);a.value[l]=e.id,t.isBefore(n)?e.status=w.WAIT_START:t.isAfter(o)?e.status=w.END:(e.status=w.STARTED,Z.value=l)})),L.value=e,K(Z.value,a.value[Z.value]),X(Z.value)})()})),(e,n)=>{const d=c,g=D,p=B,v=C,m=I,h=W,k=_(y("su-progress"),F),b=E,$=_(y("s-goods-column"),R),M=_(y("uni-load-more"),Y),z=_(y("s-layout"),P);return t(),s(z,{bgStyle:{color:"rgb(245,28,19)"},navbar:"inner"},{default:a((()=>{var e,n;return[l(d,{class:"page-bg",style:i([{marginTop:"-"+Number(G+88)+"rpx"}])},null,8,["style"]),(null==(n=null==(e=J.value)?void 0:e.sliderPicUrls)?void 0:n.length)>0?(t(),s(d,{key:0,class:"header"},{default:a((()=>[l(v,{"indicator-dots":"true",autoplay:"true",circular:!0,interval:"3000",duration:"1500","indicator-color":"rgba(255,255,255,0.6)","indicator-active-color":"#fff"},{default:a((()=>[(t(!0),T(S,null,A(J.value.sliderPicUrls,((e,n)=>(t(),s(p,{key:n,class:"borRadius14"},{default:a((()=>[l(g,{src:e,class:"slide-image borRadius14","lazy-load":""},null,8,["src"])])),_:2},1024)))),128))])),_:1})])),_:1})):o("",!0),l(d,{class:"flex align-center justify-between ss-p-25"},{default:a((()=>[l(d,{class:"time-icon"},{default:a((()=>[l(g,{class:"ss-w-100 ss-h-100",src:x(f).$url.static("/static/img/shop/priceTag.png")},null,8,["src"])])),_:1}),l(m,{class:"time-list","scroll-into-view":V.value,"scroll-x":"","scroll-with-animation":""},{default:a((()=>[(t(!0),T(S,null,A(L.value,((e,n)=>(t(),s(d,{key:n,class:j(["item",{active:Z.value===n}]),id:`timeItem${n}`,onClick:t=>K(n,e.id)},{default:a((()=>[l(d,{class:"time"},{default:a((()=>[r(u(e.startTime),1)])),_:2},1024),l(d,{class:"status"},{default:a((()=>[r(u(null==e?void 0:e.status),1)])),_:2},1024)])),_:2},1032,["class","id","onClick"])))),128))])),_:1},8,["scroll-into-view"])])),_:1}),l(d,{class:"list-content"},{default:a((()=>[l(d,{class:"content-header ss-flex-col ss-col-center ss-row-center"},{default:a((()=>[l(d,{class:"content-header-box ss-flex ss-row-center"},{default:a((()=>{var e;return[(null==(e=J.value)?void 0:e.status)===x(w).STARTED?(t(),s(d,{key:0,class:"countdown-box ss-flex"},{default:a((()=>[l(d,{class:"countdown-title ss-m-r-12"},{default:a((()=>[r("距结束")])),_:1}),l(d,{class:"ss-flex countdown-time"},{default:a((()=>[l(d,{class:"ss-flex countdown-h"},{default:a((()=>[r(u(O.value.h),1)])),_:1}),l(d,{class:"ss-m-x-4"},{default:a((()=>[r(":")])),_:1}),l(d,{class:"countdown-num ss-flex ss-row-center"},{default:a((()=>[r(u(O.value.m),1)])),_:1}),l(d,{class:"ss-m-x-4"},{default:a((()=>[r(":")])),_:1}),l(d,{class:"countdown-num ss-flex ss-row-center"},{default:a((()=>[r(u(O.value.s),1)])),_:1})])),_:1})])),_:1})):(t(),s(d,{key:1},{default:a((()=>{var e;return[r(u(null==(e=J.value)?void 0:e.status),1)]})),_:1}))]})),_:1})])),_:1}),l(m,{class:"scroll-box",style:i({height:q+"rpx"}),"scroll-y":"true","scroll-with-animation":!1,"enable-back-to-top":!0},{default:a((()=>[(t(!0),T(S,null,A(te.value,(e=>(t(),s(d,{class:"goods-box ss-m-b-20",key:e.id},{default:a((()=>[l($,{size:"lg",data:{...e,price:e.seckillPrice},goodsFields:H,seckillTag:!0},{activity:a((()=>[l(d,{class:"limit"},{default:a((()=>[r(" 限量 "),l(h,{class:"ss-m-l-5"},{default:a((()=>[r(u(e.stock)+" "+u(e.unitName),1)])),_:2},1024)])),_:2},1024),l(k,{percentage:e.percent,strokeWidth:"10",textInside:"",isAnimate:""},null,8,["percentage"])])),cart:a((()=>{var l,n,o,i,r;return[(null==(l=J.value)?void 0:l.status)===x(w).WAIT_START?(t(),s(b,{key:0,class:j(["ss-reset-button cart-btn",{disabled:(null==(n=J.value)?void 0:n.status)===x(w).END}])},{default:a((()=>[N("span",null,"未开始")])),_:1},8,["class"])):(null==(o=J.value)?void 0:o.status)===x(w).STARTED?(t(),s(b,{key:1,class:j(["ss-reset-button cart-btn",{disabled:(null==(i=J.value)?void 0:i.status)===x(w).END}]),onClick:t=>x(f).$router.go("/pages/goods/seckill",{id:e.id})},{default:a((()=>[N("span",null,"马上抢")])),_:2},1032,["class","onClick"])):(t(),s(b,{key:2,class:j(["ss-reset-button cart-btn",{disabled:(null==(r=J.value)?void 0:r.status)===x(w).END}])},{default:a((()=>[N("span",null,"已结束")])),_:1},8,["class"]))]})),_:2},1032,["data"])])),_:2},1024)))),128)),ee.value>0?(t(),s(M,{key:0,status:se.value,"content-text":{contentdown:"上拉加载更多"},onClick:le},null,8,["status"])):o("",!0)])),_:1},8,["style"])])),_:1})]})),_:1},8,["bgStyle"])}}},[["__scopeId","data-v-8752df97"]]);export{G as default};
