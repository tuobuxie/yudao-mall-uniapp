import{B as s,s as e,v as a,c as t,o as l,b5 as o,aE as n,r,e as i,f as c,w as d,u,c7 as f,j as m,k as p,p as y,A as g,t as _,g as w,l as h,m as b,F as k,aF as x,P as M,i as T,H as v,G as C,c8 as S}from"./index-Ch_jkemp.js";import{_ as $}from"./uni-datetime-picker.BmDPyAiM.js";import{_ as j}from"./su-tabs.Cbk9L_9y.js";import{_ as B}from"./su-sticky.BH_EELdm.js";import{_ as P}from"./s-empty.DdU54__M.js";import{g as N,c as I,S as z}from"./s-layout.Ckk_oEQ_.js";import{_ as V}from"./uni-load-more.C8hvkNiT.js";import{f as G}from"./useGoods.CmR2wUi_.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{c as W}from"./concat.B-rUqbX7.js";const Y=F({__name:"wallet",setup(F){s((s=>({"184a6e59":u(Y)})));const Y=e.$url.css("/static/img/shop/user/wallet_card_bg.png"),R=a({showMoney:!1,summary:{},today:"",date:[],currentTab:0,pagination:{list:[],total:0,pageNo:1,pageSize:8},loadStatus:"",price:void 0,showModal:!1}),U=[{name:"分佣",value:"1"},{name:"提现",value:"2"}],D=t((()=>R.date[0]===R.date[1]?R.date[0]:R.date.join("~")));async function q(){R.loadStatus="loading";let{code:s,data:e}=await(0===R.currentTab?f.getBrokerageRecordPage({pageSize:R.pagination.pageSize,pageNo:R.pagination.pageNo,"createTime[0]":R.date[0]+" 00:00:00","createTime[1]":R.date[1]+" 23:59:59"}):f.getBrokerageWithdrawPage({pageSize:R.pagination.pageSize,pageNo:R.pagination.pageNo,"createTime[0]":R.date[0]+" 00:00:00","createTime[1]":R.date[1]+" 23:59:59"}));0===s&&(R.pagination.list=W(R.pagination.list,e.list),R.pagination.total=e.total,R.loadStatus=R.pagination.list.length<R.pagination.total?"more":"noMore")}function A(s){x(R.pagination),R.currentTab=s.index,q()}function E(s){R.date[0]=s[0],R.date[1]=s[s.length-1],x(R.pagination),q()}async function H(){R.price<=0?e.$helper.toast("请输入正确的金额"):M({title:"提示",content:"确认把您的佣金转入到余额钱包中？",success:async function(s){if(!s.confirm)return;const{code:e}=await f.createBrokerageWithdraw({type:1,price:100*R.price});0===e&&(R.showModal=!1,await Z(),A({index:1}))}})}async function Z(){const{code:s,data:e}=await f.getBrokerageUserSummary();0===s&&(R.summary=e)}return l((async s=>{R.today=o().format("YYYY-MM-DD"),R.date=[R.today,R.today],"2"===s.type&&(R.currentTab=1),q(),Z()})),n((()=>{"noMore"!==R.loadStatus&&(R.pagination.pageNo++,q())})),(s,a)=>{const t=T,l=v,o=C,n=r(i("uni-datetime-picker"),$),x=r(i("su-tabs"),j),M=r(i("su-sticky"),B),F=r(i("s-empty"),P),W=r(i("uni-easyinput"),N),Y=r(i("su-popup"),I),q=r(i("uni-load-more"),V),Z=r(i("s-layout"),z);return m(),c(Z,{class:"wallet-wrap",title:"佣金"},{default:d((()=>[p(t,{class:"header-box ss-flex ss-row-center ss-col-center"},{default:d((()=>[p(t,{class:"card-box ui-BG-Main ui-Shadow-Main"},{default:d((()=>[p(t,{class:"card-head ss-flex ss-col-center"},{default:d((()=>[p(t,{class:"card-title ss-m-r-10"},{default:d((()=>[y("当前佣金（元）")])),_:1}),p(t,{onClick:a[0]||(a[0]=s=>R.showMoney=!R.showMoney),class:g(["ss-eye-icon",R.showMoney?"cicon-eye":"cicon-eye-off"])},null,8,["class"])])),_:1}),p(t,{class:"ss-flex ss-row-between ss-col-center ss-m-t-30"},{default:d((()=>[p(t,{class:"money-num"},{default:d((()=>[y(_(R.showMoney?u(G)(R.summary.withdrawPrice||0):"*****"),1)])),_:1}),p(t,{class:"ss-flex"},{default:d((()=>[p(t,{class:"ss-m-r-20"},{default:d((()=>[p(l,{class:"ss-reset-button withdraw-btn",onClick:a[1]||(a[1]=s=>u(e).$router.go("/pages/commission/withdraw"))},{default:d((()=>[y(" 提现 ")])),_:1})])),_:1}),p(l,{class:"ss-reset-button balance-btn ss-m-l-20",onClick:a[2]||(a[2]=s=>R.showModal=!0)},{default:d((()=>[y(" 转余额 ")])),_:1})])),_:1})])),_:1}),p(t,{class:"ss-flex"},{default:d((()=>[p(t,{class:"loading-money"},{default:d((()=>[p(t,{class:"loading-money-title"},{default:d((()=>[y("冻结佣金")])),_:1}),p(t,{class:"loading-money-num"},{default:d((()=>[y(_(R.showMoney?u(G)(R.summary.frozenPrice||0):"*****"),1)])),_:1})])),_:1}),p(t,{class:"loading-money ss-m-l-100"},{default:d((()=>[p(t,{class:"loading-money-title"},{default:d((()=>[y("可提现佣金")])),_:1}),p(t,{class:"loading-money-num"},{default:d((()=>[y(_(R.showMoney?u(G)(R.summary.brokeragePrice||0):"*****"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),p(M,null,{default:d((()=>[p(t,{class:"filter-box ss-p-x-30 ss-flex ss-col-center ss-row-between"},{default:d((()=>[p(n,{modelValue:R.date,"onUpdate:modelValue":a[3]||(a[3]=s=>R.date=s),type:"daterange",onChange:E,end:R.today},{default:d((()=>[p(l,{class:"ss-reset-button date-btn"},{default:d((()=>[p(o,null,{default:d((()=>[y(_(D.value),1)])),_:1}),p(o,{class:"cicon-drop-down ss-seldate-icon"})])),_:1})])),_:1},8,["modelValue","end"]),p(t,{class:"total-box"})])),_:1}),p(x,{list:U,onChange:A,scrollable:!1,current:R.currentTab},null,8,["current"])])),_:1}),0===R.pagination.total?(m(),c(F,{key:0,icon:"/static/data-empty.png",text:"暂无数据"})):w("",!0),p(Y,{show:R.showModal,type:"bottom",round:"20",onClose:a[5]||(a[5]=s=>R.showModal=!1),showClose:""},{default:d((()=>[p(t,{class:"ss-p-x-20 ss-p-y-30"},{default:d((()=>[p(t,{class:"model-title ss-m-b-30 ss-m-l-20"},{default:d((()=>[y("转余额")])),_:1}),p(t,{class:"model-subtitle ss-m-b-100 ss-m-l-20"},{default:d((()=>[y("将您的佣金转到余额中继续消费")])),_:1}),p(t,{class:"input-box ss-flex ss-col-center border-bottom ss-m-b-70 ss-m-x-20"},{default:d((()=>[p(t,{class:"unit"},{default:d((()=>[y("￥")])),_:1}),p(W,{inputBorder:!1,class:"ss-flex-1 ss-p-l-10",modelValue:R.price,"onUpdate:modelValue":a[4]||(a[4]=s=>R.price=s),type:"number",placeholder:"请输入金额"},null,8,["modelValue"])])),_:1}),p(l,{class:"ss-reset-button model-btn ui-BG-Main-Gradient ui-Shadow-Main",onClick:H},{default:d((()=>[y(" 确定 ")])),_:1})])),_:1})])),_:1},8,["show"]),R.pagination.total>0?(m(),c(t,{key:1},{default:d((()=>[0===R.currentTab?(m(),c(t,{key:0},{default:d((()=>[(m(!0),h(k,null,b(R.pagination.list,(s=>(m(),c(t,{class:"wallet-list ss-flex border-bottom",key:s.id},{default:d((()=>[p(t,{class:"list-content"},{default:d((()=>[p(t,{class:"title-box ss-flex ss-row-between ss-m-b-20"},{default:d((()=>[p(o,{class:"title ss-line-1"},{default:d((()=>[y(_(s.title),1)])),_:2},1024),p(t,{class:"money"},{default:d((()=>[s.price>=0?(m(),c(o,{key:0,class:"add"},{default:d((()=>[y("+"+_(u(G)(s.price)),1)])),_:2},1024)):(m(),c(o,{key:1,class:"minus"},{default:d((()=>[y(_(u(G)(s.price)),1)])),_:2},1024))])),_:2},1024)])),_:2},1024),p(t,{class:"ss-flex ss-row-between ss-col-center"},{default:d((()=>[p(o,{class:"time"},{default:d((()=>[y(_(u(e).$helper.timeFormat(s.createTime,"yyyy-mm-dd hh:MM:ss")),1)])),_:2},1024),p(t,{class:"ss-flex ss-col-center"},{default:d((()=>[p(o,{class:g(["status","status-"+s.status])},{default:d((()=>[y(_(s.statusName),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(m(),c(t,{key:1},{default:d((()=>[(m(!0),h(k,null,b(R.pagination.list,(s=>(m(),c(t,{class:"wallet-list ss-flex border-bottom",key:s.id},{default:d((()=>[p(t,{class:"list-content"},{default:d((()=>[p(t,{class:"title-box ss-flex ss-row-between ss-m-b-20"},{default:d((()=>[p(o,{class:"title ss-line-1"},{default:d((()=>[y(_(s.typeName),1)])),_:2},1024),p(t,{class:"money"},{default:d((()=>[p(o,{class:"minus"},{default:d((()=>[y(_(u(G)(s.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(t,{class:"ss-flex ss-row-between ss-col-center"},{default:d((()=>[p(o,{class:"time"},{default:d((()=>[y(_(u(e).$helper.timeFormat(s.createTime,"yyyy-mm-dd hh:MM:ss")),1)])),_:2},1024),10===s.status&&5===s.type&&s.payTransferId>0?(m(),c(l,{key:0,class:"ss-reset-button confirm-btn ss-m-l-20",onClick:a=>async function(s){const a=e.$platform.useProvider()?e.$platform.useProvider().requestMerchantTransfer:void 0;if(!a)return void e.$helper.toast("仅微信平台支持该功能");const{code:t,data:l}=await f.getBrokerageWithdraw(s.id);if(0!==t)return;if(11===l.status)return e.$helper.toast("该提现单已确认收款"),void(s.status=11);if(!l.transferChannelMchId||!l.transferChannelPackageInfo)return void e.$helper.toast("提现信息异常，请稍后再试");const o=l.payTransferId;await a(l.transferChannelMchId,l.transferChannelPackageInfo,(async a=>{if("success"!==a.result)return void e.$helper.toast(a.errMsg);try{const s=await S.syncTransfer(o);console.log("syncTransferResult 结果",s)}catch(l){console.error("syncTransferResult 异常",l)}const{data:t}=await f.getBrokerageWithdraw(s.id);t&&11!==t.status?e.$helper.toast("确认收款成功，但数据存在延迟，请以实际【微信支付】到账为准"):(e.$helper.toast("确认收款成功"),s.status=11)}))}(s)},{default:d((()=>[y(" 确认收款 ")])),_:2},1032,["onClick"])):(m(),c(o,{key:1,class:g(["status","status-"+s.status])},{default:d((()=>[y(_(s.statusName),1)])),_:2},1032,["class"]))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1})):w("",!0),R.pagination.total>0?(m(),c(q,{key:2,status:R.loadStatus,"content-text":{contentdown:"上拉加载更多"}},null,8,["status"])):w("",!0)])),_:1})}}},[["__scopeId","data-v-b45cf4be"]]);export{Y as default};
