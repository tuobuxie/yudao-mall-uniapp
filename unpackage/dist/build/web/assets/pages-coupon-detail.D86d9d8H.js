import{v as o,o as s,aE as a,r as t,e,f as n,w as c,ae as l,j as i,k as u,u as p,s as d,p as r,t as m,A as g,g as f,l as y,m as _,F as b,aF as k,S as w,C as S,af as h,q as x,i as T,G as j,H as C}from"./index-Ch_jkemp.js";import{_ as I,a as v}from"./uni-collapse.BBqqZojF.js";import{_ as F}from"./su-tabs.Cbk9L_9y.js";import{_ as M}from"./su-sticky.BH_EELdm.js";import{_ as z}from"./s-goods-column.ww3VogJ9.js";import{_ as $}from"./uni-load-more.C8hvkNiT.js";import{_ as N}from"./s-empty.DdU54__M.js";import{S as P}from"./s-layout.Ckk_oEQ_.js";import{f as E}from"./useGoods.CmR2wUi_.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{c as G}from"./concat.B-rUqbX7.js";const L=B({__name:"detail",setup(B){const L=o({id:0,couponId:0,coupon:{},pagination:{list:[],total:0,pageNo:1,pageSize:8},categoryId:0,tabMaps:[],currentTab:0,loadStatus:""});function V(o){k(L.pagination),L.currentTab=o.index,L.categoryId=o.value,q()}async function q(){L.loadStatus="loading";const{code:o,data:s}=await w.getSpuPage({categoryId:L.categoryId,pageNo:L.pagination.pageNo,pageSize:L.pagination.pageSize});0===o&&(L.pagination.list=G(L.pagination.list,s.list),L.pagination.total=s.total,L.loadStatus=L.pagination.list.length<L.pagination.total?"more":"noMore")}async function A(){const{code:o}=await l.takeCoupon(L.id);0===o&&(h({title:"领取成功"}),setTimeout((()=>{H()}),1e3))}async function H(){const{code:o,data:s}=L.id>0?await l.getCouponTemplate(L.id):await l.getCoupon(L.couponId);0===o&&(L.coupon=s,2===L.coupon.productScope?await async function(){const{data:o,code:s}=await w.getSpuListByIds(L.coupon.productScopeValues.join(","));0===s&&(L.pagination.list=o)}():3===L.coupon.productScope&&await async function(){const{data:o,code:s}=await S.getCategoryListByIds(L.coupon.productScopeValues.join(","));0===s&&(L.tabMaps=o.map((o=>({name:o.name,value:o.id}))),L.tabMaps.length>0&&(L.categoryId=L.tabMaps[0].value,await q()))}())}function Z(){"noMore"!==L.loadStatus&&(L.pagination.pageNo++,q())}return s((o=>{L.id=o.id,L.couponId=o.couponId,H(L.id,L.couponId)})),a((()=>{Z()})),(o,s)=>{const a=x,l=T,k=j,w=C,S=t(e("uni-collapse-item"),I),h=t(e("uni-collapse"),v),B=t(e("su-tabs"),F),G=t(e("su-sticky"),M),q=t(e("s-goods-column"),z),H=t(e("uni-load-more"),$),D=t(e("s-empty"),N),J=t(e("s-layout"),P);return i(),n(J,{title:"优惠券详情"},{default:c((()=>[u(l,{class:"bg-white"},{default:c((()=>[u(l,{class:"detail-wrap ss-p-20"},{default:c((()=>[u(l,{class:"detail-box"},{default:c((()=>[u(l,{class:"tag-box ss-flex ss-col-center ss-row-center"},{default:c((()=>[u(a,{class:"tag-image",src:p(d).$url.static("/static/img/shop/app/coupon_icon.png"),mode:"aspectFit"},null,8,["src"])])),_:1}),u(l,{class:"top ss-flex-col ss-col-center"},{default:c((()=>[u(l,{class:"title ss-m-t-50 ss-m-b-20 ss-m-x-20"},{default:c((()=>[r(m(L.coupon.name),1)])),_:1}),u(l,{class:"subtitle ss-m-b-50"},{default:c((()=>[r(" 满 "+m(p(E)(L.coupon.usePrice))+" 元， "+m(1===L.coupon.discountType?"减 "+p(E)(L.coupon.discountPrice)+" 元":"打 "+L.coupon.discountPercent/10+" 折"),1)])),_:1}),u(w,{class:g(["ss-reset-button ss-m-b-30",L.coupon.canTake||1===L.coupon.status?"use-btn":"disable-btn"]),disabled:!L.coupon.canTake,onClick:A},{default:c((()=>[L.id>0?(i(),n(k,{key:0},{default:c((()=>[r(m(L.coupon.canTake?"立即领取":"已领取"),1)])),_:1})):(i(),n(k,{key:1},{default:c((()=>[r(m(1===L.coupon.status?"可使用":2===L.coupon.status?"已使用":"已过期"),1)])),_:1}))])),_:1},8,["class","disabled"]),2===L.coupon.validityType?(i(),n(l,{key:0,class:"time ss-m-y-30"},{default:c((()=>[r(" 有效期：领取后 "+m(L.coupon.fixedEndTerm)+" 天内可用 ",1)])),_:1})):(i(),n(l,{key:1,class:"time ss-m-y-30"},{default:c((()=>[r(" 有效期: "+m(p(d).$helper.timeFormat(L.coupon.validStartTime,"yyyy-mm-dd"))+" 至 "+m(p(d).$helper.timeFormat(L.coupon.validEndTime,"yyyy-mm-dd")),1)])),_:1})),u(l,{class:"coupon-line ss-m-t-14"})])),_:1}),u(l,{class:"bottom"},{default:c((()=>[u(l,{class:"type ss-flex ss-col-center ss-row-between ss-p-x-30"},{default:c((()=>[u(l,null,{default:c((()=>[r("优惠券类型")])),_:1}),u(l,null,{default:c((()=>[r(m(1===L.coupon.discountType?"满减券":"折扣券"),1)])),_:1})])),_:1}),u(h,null,{default:c((()=>[L.coupon.description?(i(),n(S,{key:0,title:"优惠券说明"},{default:c((()=>[u(l,{class:"content ss-p-b-20"},{default:c((()=>[u(k,{class:"des ss-p-l-30"},{default:c((()=>[r(m(L.coupon.description),1)])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),1===L.coupon.productScope?(i(),n(l,{key:0,class:"all-user ss-flex ss-row-center ss-col-center"},{default:c((()=>[r(" 全场通用 ")])),_:1})):(i(),n(G,{key:1,bgColor:"#fff"},{default:c((()=>[u(l,{class:"goods-title ss-p-20"},{default:c((()=>[r(m(2===L.coupon.productScope?"指定商品可用":"指定分类可用"),1)])),_:1}),3===L.coupon.productScope?(i(),n(B,{key:0,scrollable:!0,list:L.tabMaps,onChange:V,current:L.currentTab},null,8,["list","current"])):f("",!0)])),_:1})),2===L.coupon.productScope?(i(),n(l,{key:2},{default:c((()=>[(i(!0),y(b,null,_(L.pagination.list,((o,s)=>(i(),n(l,{key:s},{default:c((()=>[u(q,{class:"ss-m-20",size:"lg",data:o,onClick:s=>p(d).$router.go("/pages/goods/index",{id:o.id}),goodsFields:{title:{show:!0},subtitle:{show:!0},price:{show:!0},original_price:{show:!0},sales:{show:!0},stock:{show:!1}}},null,8,["data","onClick"])])),_:2},1024)))),128))])),_:1})):f("",!0),3===L.coupon.productScope?(i(),n(l,{key:3},{default:c((()=>[(i(!0),y(b,null,_(L.pagination.list,((o,s)=>(i(),n(l,{key:s},{default:c((()=>[u(q,{class:"ss-m-20",size:"lg",data:o,onClick:s=>p(d).$router.go("/pages/goods/index",{id:o.id}),goodsFields:{title:{show:!0},subtitle:{show:!0},price:{show:!0},original_price:{show:!0},sales:{show:!0},stock:{show:!1}}},null,8,["data","onClick"])])),_:2},1024)))),128))])),_:1})):f("",!0),L.pagination.total>0&&3===L.coupon.productScope?(i(),n(H,{key:4,status:L.loadStatus,"content-text":{contentdown:"上拉加载更多"},onClick:Z},null,8,["status"])):f("",!0),3===L.coupon.productScope&&0===L.pagination.total?(i(),n(D,{key:5,paddingTop:"0",icon:"/static/soldout-empty.png",text:"暂无商品"})):f("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-cff3c0f5"]]);export{L as default};
