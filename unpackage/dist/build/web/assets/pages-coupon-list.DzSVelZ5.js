import{v as a,o as t,aE as o,r as s,e,f as n,w as i,ae as l,j as u,k as p,g as r,l as c,m as d,F as g,aF as f,u as m,s as b,A as y,D as k,p as _,t as T,af as C,H as S,i as j}from"./index-kPUodEo8.js";import{_ as v}from"./su-tabs.BcL6QNZj.js";import{_ as x}from"./su-sticky.B6SSP8sh.js";import{_ as w}from"./s-empty.B9iGK6-f.js";import{_ as N}from"./s-coupon-list.BLQK9iBj.js";import{_ as z}from"./uni-load-more.8Kzkyk-l.js";import{S as h}from"./s-layout.ChN2kRO2.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{c as M}from"./concat.CXHZS4ws.js";import"./useGoods.CNv-03RG.js";const $=I({__name:"list",setup(I){const $=a({currentTab:0,type:"1",pagination:{list:[],total:0,pageNo:1,pageSize:5},loadStatus:""}),F=[{name:"领券中心",value:"all"},{name:"已领取",value:"1"},{name:"已使用",value:"2"},{name:"已失效",value:"3"}];function P(a){$.currentTab=a.index,$.type=a.value,f($.pagination),0===$.currentTab?A():D()}async function A(){$.loadStatus="loading";const{data:a,code:t}=await l.getCouponTemplatePage({pageNo:$.pagination.pageNo,pageSize:$.pagination.pageSize});0===t&&($.pagination.list=M($.pagination.list,a.list),$.pagination.total=a.total,$.loadStatus=$.pagination.list.length<$.pagination.total?"more":"noMore")}async function D(){$.loadStatus="loading";const{data:a,code:t}=await l.getCouponPage({pageNo:$.pagination.pageNo,pageSize:$.pagination.pageSize,status:$.type});0===t&&($.pagination.list=M($.pagination.list,a.list),$.pagination.total=a.total,$.loadStatus=$.pagination.list.length<$.pagination.total?"more":"noMore")}function E(){"noMore"!==$.loadStatus&&($.pagination.pageNo++,0===$.currentTab?A():D())}return t((a=>{"all"!==a.type&&a.type?("geted"===a.type?$.currentTab=1:"used"===a.type?$.currentTab=2:$.currentTab=3,$.type=$.currentTab,D()):A()})),o((()=>{E()})),(a,t)=>{const o=s(e("su-tabs"),v),I=s(e("su-sticky"),x),M=s(e("s-empty"),w),D=S,G=s(e("s-coupon-list"),N),H=j,Z=s(e("uni-load-more"),z),q=s(e("s-layout"),h);return u(),n(q,{bgStyle:{color:"#f2f2f2"},title:"优惠券"},{default:i((()=>[p(I,{bgColor:"#fff"},{default:i((()=>[p(o,{list:F,scrollable:!1,onChange:P,current:$.currentTab},null,8,["current"])])),_:1}),0===$.pagination.total?(u(),n(M,{key:0,icon:"/static/coupon-empty.png",text:"暂无优惠券"})):r("",!0),0===$.currentTab?(u(!0),c(g,{key:1},d($.pagination.list,(a=>(u(),n(H,{key:a.id},{default:i((()=>[p(G,{data:a,onClick:t=>m(b).$router.go("/pages/coupon/detail",{id:a.id})},{default:i((()=>[p(D,{class:y(["ss-reset-button card-btn ss-flex ss-row-center ss-col-center",a.canTake?"":"border-btn"]),onClick:k((t=>async function(a){const{code:t}=await l.takeCoupon(a);0===t&&(C({title:"领取成功"}),setTimeout((()=>{f($.pagination),A()}),1e3))}(a.id)),["stop"]),disabled:!a.canTake},{default:i((()=>[_(T(a.canTake?"立即领取":"已领取"),1)])),_:2},1032,["class","onClick","disabled"])])),_:2},1032,["data","onClick"])])),_:2},1024)))),128)):(u(!0),c(g,{key:2},d($.pagination.list,(a=>(u(),n(H,{key:a.id},{default:i((()=>[p(G,{data:a,type:"user",onClick:t=>m(b).$router.go("/pages/coupon/detail",{couponId:a.id})},{default:i((()=>[p(D,{class:y(["ss-reset-button card-btn ss-flex ss-row-center ss-col-center",1!==a.status?"disabled-btn":""]),disabled:1!==a.status,onClick:k((t=>m(b).$router.go("/pages/coupon/detail",{couponId:a.id})),["stop"])},{default:i((()=>[_(T(1===a.status?"立即使用":2===a.status?"已使用":"已过期"),1)])),_:2},1032,["class","disabled","onClick"])])),_:2},1032,["data","onClick"])])),_:2},1024)))),128)),$.pagination.total>0?(u(),n(Z,{key:3,status:$.loadStatus,"content-text":{contentdown:"上拉加载更多"},onClick:E},null,8,["status"])):r("",!0)])),_:1})}}},[["__scopeId","data-v-462bc2e8"]]);export{$ as default};
