import{_ as s}from"./s-empty.B9iGK6-f.js";import{v as o,a3 as e,a5 as t,j as a,f as l,w as n,k as i,p as c,t as d,l as u,F as r,m as f,u as g,s as p,D as m,g as _,i as k,G as b,q as y,H as I,B as x,d as w,c as v,o as S,S as h,r as j,e as $,A as C,an as A,ao as P}from"./index-kPUodEo8.js";import{_ as T}from"./su-swiper.DGFO1a5m.js";import{_ as N}from"./s-select-groupon-sku.qBmQjsAZ.js";import{S as V}from"./s-layout.ChN2kRO2.js";import{d as H,a as L,_ as U,b as D,c as z,e as M}from"./detail-content-card.GtVev5vS.js";import{u as O,e as G,f as q}from"./useGoods.CNv-03RG.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./su-number-box.C1ckS1QE.js";import"./comment-item.BSwxGQ2Z.js";import"./uni-rate.DYcjJNnW.js";import"./su-image.CGcknAx7.js";import"./mp-html.DDyblAx6.js";const F=B({__name:"groupon-card-list",props:{modelValue:{type:Object,default(){}}},emits:["join"],setup(s,{emit:x}){const w=s,v=o({list:[]}),S=x;function h(s){const o=O(s);if(o.ms<=0)return"该团已解散";let e="剩余 ";return e+=`${o.h}时`,e+=`${o.m}分`,e+=`${o.s}秒`,e}return e((async()=>{const{data:s}=await t.getHeadCombinationRecordList(w.modelValue.id,0,10);v.list=s})),(s,o)=>{const e=k,t=b,x=y,w=I;return v.list.length>0?(a(),l(e,{key:0,class:"groupon-list detail-card ss-p-x-20"},{default:n((()=>[i(e,{class:"join-activity ss-flex ss-row-between ss-m-t-30"},{default:n((()=>[i(e,{class:""},{default:n((()=>[c("已有"+d(v.list.length)+"人参与活动",1)])),_:1}),i(t,{class:"cicon-forward"})])),_:1}),(a(!0),u(r,null,f(v.list,((s,o)=>(a(),l(e,{onClick:o=>g(p).$router.go("/pages/activity/groupon/detail",{id:s.id}),key:o,class:"ss-m-t-40 ss-flex ss-row-between border-bottom ss-p-b-30"},{default:n((()=>[i(e,{class:"ss-flex ss-col-center"},{default:n((()=>[i(x,{src:g(p).$url.cdn(s.avatar),class:"user-avatar"},null,8,["src"]),i(e,{class:"user-nickname ss-m-l-20 ss-line-1"},{default:n((()=>[c(d(s.nickname),1)])),_:2},1024)])),_:2},1024),i(e,{class:"ss-flex ss-col-center"},{default:n((()=>[i(e,{class:"ss-flex-col ss-col-bottom ss-m-r-20"},{default:n((()=>[i(e,{class:"title ss-flex ss-m-b-14"},{default:n((()=>[c(" 还差 "),i(e,{class:"num"},{default:n((()=>[c(d(s.userSize-s.userCount)+"人",1)])),_:2},1024),c(" 成团 ")])),_:2},1024),i(e,{class:"end-time"},{default:n((()=>[c(d(h(s.expireTime)),1)])),_:2},1024)])),_:2},1024),i(e,{class:""},{default:n((()=>[i(w,{class:"ss-reset-button go-btn",onClick:m((o=>function(s){S("join",s)}(s)),["stop"])},{default:n((()=>[c(" 去参团 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):_("",!0)}}},[["__scopeId","data-v-f74a064d"]]),J=B({__name:"groupon",setup(e){x((s=>({"61956acc":g(f),"5da656e7":g(m),c128586a:g(b),f512a4ae:g(B)})));const f=p.$url.css("/static/img/shop/goods/groupon-bg.png"),m=p.$url.css("/static/img/shop/goods/groupon-btn.png"),b=p.$url.css("/static/img/shop/goods/activity-btn-disabled.png"),B=p.$url.css("/static/img/shop/goods/groupon-tip-bg.png");w((()=>{}));const J=o({skeletonLoading:!0,goodsId:0,goodsInfo:{},goodsSwiper:[],showSelectSku:!1,selectedSku:{},activity:{},grouponId:0,grouponNum:0,grouponAction:"create",combinationHeadId:null}),R=v((()=>O(J.activity.endTime)));function E(s){J.selectedSku=s}function Z(){J.showSelectSku=!1}function K(){J.grouponAction="create",J.grouponId=0,J.showSelectSku=!0}function Q(s){J.grouponAction="join",J.grouponId=s.activityId,J.combinationHeadId=s.id,J.grouponNum=s.userSize,J.showSelectSku=!0}function W(s){p.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",combinationActivityId:J.activity.id,combinationHeadId:J.combinationHeadId,items:[{skuId:s.id,count:s.count}]})})}const X=v((()=>A(J.activity)?{}:p.$platform.share.getShareInfo({title:J.activity.name,image:p.$url.cdn(J.goodsInfo.picUrl),params:{page:P.GROUPON.value,query:J.activity.id}},{type:"goods",title:J.activity.name,image:p.$url.cdn(J.goodsInfo.picUrl),price:q(J.goodsInfo.price),marketPrice:q(J.goodsInfo.marketPrice)})));return S((async s=>{if(!s.id)return J.goodsInfo=null,void(J.skeletonLoading=!1);J.grouponId=s.id;const{code:o,data:e}=await t.getCombinationActivity(J.grouponId);if(0!==o)return J.goodsInfo=null,void(J.skeletonLoading=!1);J.activity=e;const{data:a}=await h.getSpuDetail(e.spuId);if(0!==o)return J.goodsInfo=null,void(J.skeletonLoading=!1);J.goodsId=a.id,a.price=e.products.reduce(((s,o)=>Math.min(s,o.combinationPrice||1/0)),1/0),a.skus.forEach((s=>{const o=e.products.find((o=>o.skuId===s.id));o?s.price=o.combinationPrice:s.stock=0})),J.skeletonLoading=!1,0===o?(J.goodsInfo=a,J.grouponNum=e.userSize,J.goodsSwiper=G(J.goodsInfo.sliderPicUrls)):J.goodsInfo=null})),(o,e)=>{const t=j($("s-empty"),s),f=j($("su-swiper"),T),m=k,b=y,x=j($("s-select-groupon-sku"),N),w=I,v=j($("s-layout"),V);return a(),l(v,{onShareAppMessage:X.value,navbar:"goods"},{default:n((()=>[i(H),J.skeletonLoading?(a(),l(L,{key:0})):null===J.goodsInfo||0!==J.activity.status||J.activity.endTime<(new Date).getTime()?(a(),l(t,{key:1,text:"活动不存在或已结束",icon:"/static/soldout-empty.png",showAction:"",actionText:"返回上一页",onClickAction:e[0]||(e[0]=s=>g(p).$router.back())})):(a(),u(r,{key:2},[i(m,{class:"detail-swiper-selector"},{default:n((()=>[i(f,{class:"ss-m-b-14",isPreview:"",list:J.goodsSwiper,dotStyle:"tag",imageMode:"widthFix",dotCur:"bg-mask-40",seizeHeight:750},null,8,["list"]),i(m,{class:"title-card detail-card ss-m-y-14 ss-m-x-20 ss-p-x-20 ss-p-y-34"},{default:n((()=>[i(m,{class:"ss-flex ss-row-between ss-m-b-60"},{default:n((()=>[i(m,null,{default:n((()=>[i(m,{class:"price-box ss-flex ss-col-bottom ss-m-b-18"},{default:n((()=>[i(m,{class:"price-text ss-m-r-16"},{default:n((()=>[c(d(g(q)(J.activity.price||J.goodsInfo.price)),1)])),_:1}),i(m,{class:"tig ss-flex ss-col-center"},{default:n((()=>[i(m,{class:"tig-icon ss-flex ss-col-center ss-row-center"},{default:n((()=>[i(m,{class:"groupon-tag"},{default:n((()=>[i(b,{src:g(p).$url.static("/static/img/shop/goods/groupon-tag.png")},null,8,["src"])])),_:1})])),_:1}),i(m,{class:"tig-title"},{default:n((()=>[c("拼团价")])),_:1})])),_:1})])),_:1}),i(m,{class:"ss-flex ss-row-between"},{default:n((()=>[J.goodsInfo.price?(a(),l(m,{key:0,class:"origin-price ss-flex ss-col-center"},{default:n((()=>[c(" 单买价： "),i(m,{class:"origin-price-text"},{default:n((()=>[c(d(g(q)(J.goodsInfo.marketPrice)),1)])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1}),R.value.ms>0?(a(),l(m,{key:0,class:"countdown-box"},{default:n((()=>[i(m,{class:"countdown-title ss-m-b-20"},{default:n((()=>[c("距结束仅剩")])),_:1}),i(m,{class:"ss-flex countdown-time"},{default:n((()=>[i(m,{class:"ss-flex countdown-h"},{default:n((()=>[c(d(R.value.h),1)])),_:1}),i(m,{class:"ss-m-x-4"},{default:n((()=>[c(":")])),_:1}),i(m,{class:"countdown-num ss-flex ss-row-center"},{default:n((()=>[c(d(R.value.m),1)])),_:1}),i(m,{class:"ss-m-x-4"},{default:n((()=>[c(":")])),_:1}),i(m,{class:"countdown-num ss-flex ss-row-center"},{default:n((()=>[c(d(R.value.s),1)])),_:1})])),_:1})])),_:1})):(a(),l(m,{key:1,class:"countdown-title"},{default:n((()=>[c(" 活动已结束 ")])),_:1}))])),_:1}),i(m,{class:"title-text ss-line-2 ss-m-b-6"},{default:n((()=>[c(d(J.goodsInfo.name),1)])),_:1}),i(m,{class:"subtitle-text ss-line-1"},{default:n((()=>[c(d(J.goodsInfo.introduction),1)])),_:1})])),_:1}),i(m,{class:"detail-cell-card detail-card ss-flex-col"},{default:n((()=>[i(U,{sku:J.selectedSku,onClick:e[1]||(e[1]=s=>J.showSelectSku=!0)},null,8,["sku"])])),_:1}),i(F,{modelValue:J.activity,"onUpdate:modelValue":e[2]||(e[2]=s=>J.activity=s),onJoin:Q},null,8,["modelValue"]),i(x,{show:J.showSelectSku,goodsInfo:J.goodsInfo,grouponAction:J.grouponAction,grouponNum:J.grouponNum,onBuy:W,onChange:E,onClose:Z},null,8,["show","goodsInfo","grouponAction","grouponNum"])])),_:1}),i(D,{class:"detail-comment-selector",goodsId:J.goodsId},null,8,["goodsId"]),i(z,{class:"detail-content-selector",content:J.goodsInfo.description},null,8,["content"]),i(M,{modelValue:J.goodsInfo,"onUpdate:modelValue":e[4]||(e[4]=s=>J.goodsInfo=s)},{default:n((()=>[i(m,{class:"buy-box ss-flex ss-col-center ss-p-r-20"},{default:n((()=>[i(w,{class:"ss-reset-button origin-price-btn ss-flex-col",onClick:e[3]||(e[3]=s=>g(p).$router.go("/pages/goods/index",{id:J.goodsInfo.id}))},{default:n((()=>[i(m,{class:"btn-price"},{default:n((()=>[c(d(g(q)(J.goodsInfo.marketPrice)),1)])),_:1}),i(m,null,{default:n((()=>[c("原价购买")])),_:1})])),_:1}),i(w,{class:C(["ss-reset-button btn-tox ss-flex-col",0===J.activity.status&&0!==J.goodsInfo.stock?"check-btn-box":"disabled-btn-box"]),onClick:K,disabled:0===J.goodsInfo.stock||0!==J.activity.status},{default:n((()=>[i(m,{class:"btn-price"},{default:n((()=>[c(d(g(q)(J.selectedSku.price*J.selectedSku.count||J.activity.price*J.selectedSku.count||J.goodsInfo.price*J.selectedSku.count||J.goodsInfo.price)),1)])),_:1}),J.activity.startTime>(new Date).getTime()?(a(),l(m,{key:0},{default:n((()=>[c("未开始")])),_:1})):J.activity.endTime<=(new Date).getTime()?(a(),l(m,{key:1},{default:n((()=>[c("已结束")])),_:1})):(a(),l(m,{key:2},{default:n((()=>[0===J.goodsInfo.stock?(a(),l(m,{key:0},{default:n((()=>[c("已售罄")])),_:1})):(a(),l(m,{key:1},{default:n((()=>[c("立即开团")])),_:1}))])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["modelValue"])],64))])),_:1},8,["onShareAppMessage"])}}},[["__scopeId","data-v-1018f2b4"]]);export{J as default};
