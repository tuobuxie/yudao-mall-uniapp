import{_ as t}from"./su-tabs.BcL6QNZj.js";import{s,v as o,o as a,aE as e,r,e as i,f as l,w as n,S as d,a4 as c,j as u,k as g,l as p,m as f,F as m,u as b,g as h,aF as k,i as y,G as _,A as S,p as x,t as w,H as L}from"./index-kPUodEo8.js";import{_ as F}from"./su-sticky.B6SSP8sh.js";import{c as C,S as v}from"./s-layout.ChN2kRO2.js";import{_ as j}from"./s-goods-column.CAq6vgsX.js";import{_ as G}from"./uni-load-more.8Kzkyk-l.js";import{_ as O}from"./s-empty.B9iGK6-f.js";import{a as z}from"./useGoods.CNv-03RG.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{c as T}from"./concat.CXHZS4ws.js";const R=I({__name:"list",emits:["close","change"],setup(I,{emit:R}){const N=s.$platform.navbar,$=o({pagination:{list:[],total:0,pageNo:1,pageSize:6},currentSort:void 0,currentOrder:void 0,currentTab:0,curFilter:0,showFilter:!1,iconStatus:!1,keyword:"",categoryId:0,tabList:[{name:"综合推荐",list:[{label:"综合推荐"},{label:"价格升序",sort:"price",order:!0},{label:"价格降序",sort:"price",order:!1}]},{name:"销量",sort:"salesCount",order:!1},{name:"新品优先",value:"createTime",order:!1}],loadStatus:"",leftGoodsList:[],rightGoodsList:[]});let H=0,A=0,M=0;function P(t=0,s="left"){"left"===s?A+=t:M+=t,$.pagination.list[H]&&(A<=M?$.leftGoodsList.push($.pagination.list[H]):$.rightGoodsList.push($.pagination.list[H]),H++)}function W(){k($.pagination),$.leftGoodsList=[],$.rightGoodsList=[],H=0,A=0,M=0}function E(t){$.keyword=t,W(),q($.currentSort,$.currentOrder)}function Z(t){if($.tabList[t.index].list)return $.currentTab=t.index,void($.showFilter=!$.showFilter);$.showFilter=!1,t.index!==$.currentTab&&($.currentTab=t.index,$.currentSort=t.sort,$.currentOrder=t.order,W(),q(t.sort,t.order))}async function q(){$.loadStatus="loading";const{code:t,data:s}=await d.getSpuPage({pageNo:$.pagination.pageNo,pageSize:$.pagination.pageSize,sortField:$.currentSort,sortAsc:$.currentOrder,categoryId:$.categoryId,keyword:$.keyword});0===t&&(await c.getSettlementProduct(s.list.map((t=>t.id)).join(",")).then((t=>{0===t.code&&z(s.list,t.data)})),$.pagination.list=T($.pagination.list,s.list),$.pagination.total=s.total,$.loadStatus=$.pagination.list.length<$.pagination.total?"more":"noMore",P())}function B(){"noMore"!==$.loadStatus&&($.pagination.pageNo++,q($.currentSort,$.currentOrder))}return a((t=>{$.categoryId=t.categoryId,$.keyword=t.keyword,q($.currentSort,$.currentOrder)})),e((()=>{B()})),(o,a)=>{const e=r(i("su-tabs"),t),d=y,c=_,k=r(i("su-sticky"),F),z=r(i("su-popup"),C),I=r(i("s-goods-column"),j),T=L,R=r(i("uni-load-more"),G),H=r(i("s-empty"),O),A=r(i("s-layout"),v);return u(),l(A,{navbar:"normal",leftWidth:0,rightWidth:0,tools:"search",defaultSearch:$.keyword,onSearch:E},{default:n((()=>[g(k,{bgColor:"#fff"},{default:n((()=>[g(d,{class:"ss-flex"},{default:n((()=>[g(d,{class:"ss-flex-1"},{default:n((()=>[g(e,{list:$.tabList,scrollable:!1,onChange:Z,current:$.currentTab},null,8,["list","current"])])),_:1}),g(d,{class:"list-icon",onClick:a[0]||(a[0]=t=>$.iconStatus=!$.iconStatus)},{default:n((()=>[$.iconStatus?(u(),l(c,{key:0,class:"sicon-goods-list"})):(u(),l(c,{key:1,class:"sicon-goods-card"}))])),_:1})])),_:1})])),_:1}),g(z,{show:$.showFilter,type:"top",round:"10",space:b(N)+38,backgroundColor:"#F6F6F6",zIndex:10,onClose:a[1]||(a[1]=t=>$.showFilter=!1)},{default:n((()=>[g(d,{class:"filter-list-box"},{default:n((()=>[(u(!0),p(m,null,f($.tabList[$.currentTab].list,((t,s)=>(u(),l(d,{class:S(["filter-item",[{"filter-item-active":s===$.curFilter}]]),key:t.value,onClick:t=>{return o=s,void($.currentSort!==$.tabList[0].list[o].sort||$.currentOrder!==$.tabList[0].list[o].order?($.showFilter=!1,$.curFilter=o,$.tabList[0].name=$.tabList[0].list[o].label,$.currentSort=$.tabList[0].list[o].sort,$.currentOrder=$.tabList[0].list[o].order,W(),q()):$.showFilter=!1);var o}},{default:n((()=>[x(w(t.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["show","space"]),$.iconStatus&&$.pagination.total>0?(u(),l(d,{key:0,class:"goods-list ss-m-t-20"},{default:n((()=>[(u(!0),p(m,null,f($.pagination.list,(t=>(u(),l(d,{class:"ss-p-l-20 ss-p-r-20 ss-m-b-20",key:t.id},{default:n((()=>[g(I,{class:"",size:"lg",data:t,topRadius:10,bottomRadius:10,onClick:o=>b(s).$router.go("/pages/goods/index",{id:t.id})},null,8,["data","onClick"])])),_:2},1024)))),128))])),_:1})):h("",!0),!$.iconStatus&&$.pagination.total>0?(u(),l(d,{key:1,class:"ss-flex ss-flex-wrap ss-p-x-20 ss-m-t-20 ss-col-top"},{default:n((()=>[g(d,{class:"goods-list-box"},{default:n((()=>[(u(!0),p(m,null,f($.leftGoodsList,(t=>(u(),l(d,{class:"left-list",key:t.id},{default:n((()=>[g(I,{class:"goods-md-box",size:"md",data:t,topRadius:10,bottomRadius:10,onClick:o=>b(s).$router.go("/pages/goods/index",{id:t.id}),onGetHeight:a[2]||(a[2]=t=>P(t,"left"))},{cart:n((()=>[g(T,{class:"ss-reset-button cart-btn"})])),_:2},1032,["data","onClick"])])),_:2},1024)))),128))])),_:1}),g(d,{class:"goods-list-box"},{default:n((()=>[(u(!0),p(m,null,f($.rightGoodsList,(t=>(u(),l(d,{class:"right-list",key:t.id},{default:n((()=>[g(I,{class:"goods-md-box",size:"md",topRadius:10,bottomRadius:10,data:t,onClick:o=>b(s).$router.go("/pages/goods/index",{id:t.id}),onGetHeight:a[3]||(a[3]=t=>P(t,"right"))},{cart:n((()=>[g(T,{class:"ss-reset-button cart-btn"})])),_:2},1032,["data","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})):h("",!0),$.pagination.total>0?(u(),l(R,{key:2,status:$.loadStatus,"content-text":{contentdown:"上拉加载更多"},onClick:B},null,8,["status"])):h("",!0),0===$.pagination.total?(u(),l(H,{key:3,icon:"/static/soldout-empty.png",text:"暂无商品"})):h("",!0)])),_:1},8,["defaultSearch"])}}},[["__scopeId","data-v-3427e0fd"]]);export{R as default};
