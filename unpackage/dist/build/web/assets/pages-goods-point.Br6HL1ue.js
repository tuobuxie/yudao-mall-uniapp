import{_ as s}from"./s-empty.B9iGK6-f.js";import{B as o,s as e,d as t,v as a,c as l,X as i,o as n,r as c,e as d,f as r,w as u,u as p,a8 as g,S as f,a7 as m,j as k,k as I,l as b,p as _,t as v,g as y,A as h,F as x,an as S,ao as w,q as P,G as $,i as j,H as C}from"./index-kPUodEo8.js";import{_ as L}from"./su-swiper.DGFO1a5m.js";import{_ as A}from"./s-select-seckill-sku.Ch0oPQWV.js";import{S as M}from"./s-layout.ChN2kRO2.js";import{e as U,k as V,f as N}from"./useGoods.CNv-03RG.js";import{d as O,a as T,_ as q,b as B,c as F,e as G}from"./detail-content-card.GtVev5vS.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./su-number-box.C1ckS1QE.js";import"./comment-item.BSwxGQ2Z.js";import"./uni-rate.DYcjJNnW.js";import"./su-image.CGcknAx7.js";import"./mp-html.DDyblAx6.js";const z=H({__name:"point",setup(H){o((s=>({f552c25e:p(z),"19c82902":p(D),"70d35ae6":p(E),"0b3abed6":p(J),"4c480b78":p(X)})));const z=e.$url.css("/static/img/shop/goods/score-bg.png"),D=e.$url.css("/static/img/shop/goods/seckill-btn.png"),E=e.$url.css("/static/img/shop/goods/activity-btn-disabled.png"),J=e.$url.css("/static/img/shop/goods/seckill-tip-bg.png"),X=e.$url.css("/static/img/shop/goods/groupon-tip-bg.png");t((()=>{}));const Z=a({skeletonLoading:!0,goodsInfo:{},showSelectSku:!1,goodsSwiper:[],selectedSku:{},showModel:!1,total:0,price:""});function K(s){Z.selectedSku=s}function Q(s){e.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",buy_type:"point",pointActivityId:W.value.id,items:[{skuId:s.id,count:s.count}]})})}const R=l((()=>S(p(W))?{}:e.$platform.share.getShareInfo({title:W.value.name,image:e.$url.cdn(Z.goodsInfo.picUrl),params:{page:w.POINT.value,query:W.value.id}},{type:"goods",title:W.value.name,image:e.$url.cdn(Z.goodsInfo.picUrl),price:(Y.value.price||0)+` + ${Y.value.point} 积分`,marketPrice:N(Z.goodsInfo.marketPrice)}))),W=i(),Y=l((()=>{if(!S(Z.selectedSku)){const s=Z.selectedSku;return{point:s.point,price:s.pointPrice?N(s.pointPrice):""}}return{point:W.value.point,price:W.value.price?N(W.value.price):""}})),ss=async s=>{const{data:o}=await f.getSpuDetail(s);if(!o)return Z.goodsInfo=null,void(Z.skeletonLoading=!1);o.activity_type=m.POINT.type,Z.goodsInfo=o,Z.goodsInfo.stock=Math.min(o.stock,W.value.stock),Z.goodsSwiper=U(Z.goodsInfo.sliderPicUrls),o.skus.forEach((s=>{const o=W.value.products.find((o=>o.skuId===s.id));o?(s.point=o.point,s.pointPrice=o.price,s.stock=Math.min(s.stock,o.stock),s.limitCount=o.count):s.stock=0})),Z.skeletonLoading=!1};return n((s=>{if(!s.id)return Z.goodsInfo=null,void(Z.skeletonLoading=!1);(async s=>{const{data:o}=await g.getPointActivity(s);if(!o)return Z.goodsInfo=null,void(Z.skeletonLoading=!1);W.value=o,await ss(o.spuId)})(s.id)})),(o,t)=>{const a=c(d("s-empty"),s),l=c(d("su-swiper"),L),i=P,n=$,g=j,f=c(d("s-select-seckill-sku"),A),S=C,w=c(d("s-layout"),M);return k(),r(w,{onShareAppMessage:R.value,navbar:"goods"},{default:u((()=>[I(O),Z.skeletonLoading?(k(),r(T,{key:0})):null===Z.goodsInfo||Z.goodsInfo.activity_type!==p(m).POINT.type?(k(),r(a,{key:1,text:"活动不存在或已结束",icon:"/static/soldout-empty.png",showAction:"",actionText:"再逛逛",actionUrl:"/pages/goods/list"})):(k(),b(x,{key:2},[I(g,{class:"detail-swiper-selector"},{default:u((()=>[I(l,{class:"ss-m-b-14",isPreview:"",list:Z.goodsSwiper,dotStyle:"tag",imageMode:"widthFix",dotCur:"bg-mask-40",seizeHeight:750},null,8,["list"]),I(g,{class:"title-card detail-card ss-p-y-40 ss-p-x-20"},{default:u((()=>[I(g,{class:"ss-flex ss-row-between ss-col-center ss-m-b-18"},{default:u((()=>[I(g,{class:"price-box ss-flex ss-col-bottom"},{default:u((()=>[I(i,{src:p(e).$url.static("/static/img/shop/goods/score1.svg"),class:"point-img"},null,8,["src"]),I(n,{class:"point-text ss-m-r-16"},{default:u((()=>[_(v(Y.value.point)+" "+v(Y.value.price&&0!==Y.value.price?`+￥${Y.value.price}`:""),1)])),_:1})])),_:1}),I(g,{class:"sales-text"},{default:u((()=>[_(v(p(V)(Z.goodsInfo.sales_show_type,Z.goodsInfo.sales)),1)])),_:1})])),_:1}),Z.goodsInfo.marketPrice?(k(),r(g,{key:0,class:"origin-price-text ss-m-b-60"},{default:u((()=>[_(" 原价：￥"+v(p(N)(Z.selectedSku.marketPrice||Z.goodsInfo.marketPrice)),1)])),_:1})):y("",!0),I(g,{class:"title-text ss-line-2 ss-m-b-6"},{default:u((()=>[_(v(Z.goodsInfo.name||""),1)])),_:1}),I(g,{class:"subtitle-text ss-line-1"},{default:u((()=>[_(v(Z.goodsInfo.introduction),1)])),_:1})])),_:1}),I(g,{class:"detail-cell-card detail-card ss-flex-col"},{default:u((()=>[I(q,{sku:Z.selectedSku,onClick:t[0]||(t[0]=s=>Z.showSelectSku=!0)},null,8,["sku"])])),_:1}),I(f,{modelValue:Z.goodsInfo,"onUpdate:modelValue":t[1]||(t[1]=s=>Z.goodsInfo=s),show:Z.showSelectSku,"single-limit-count":W.value.singleLimitCount,onBuy:Q,onChange:K,onClose:t[2]||(t[2]=s=>Z.showSelectSku=!1)},null,8,["modelValue","show","single-limit-count"])])),_:1}),I(B,{class:"detail-comment-selector",goodsId:Z.goodsInfo.id},null,8,["goodsId"]),I(F,{class:"detail-content-selector",content:Z.goodsInfo.description},null,8,["content"]),I(G,{modelValue:Z.goodsInfo,"onUpdate:modelValue":t[5]||(t[5]=s=>Z.goodsInfo=s)},{default:u((()=>[I(g,{class:"buy-box ss-flex ss-col-center ss-p-r-20"},{default:u((()=>[Z.goodsInfo.marketPrice?(k(),r(S,{key:0,class:"ss-reset-button origin-price-btn ss-flex-col",onClick:t[3]||(t[3]=s=>p(e).$router.go("/pages/goods/index",{id:Z.goodsInfo.id}))},{default:u((()=>[I(g,null,{default:u((()=>[I(g,{class:"btn-price"},{default:u((()=>[_(v(p(N)(Z.goodsInfo.marketPrice)),1)])),_:1}),I(g,null,{default:u((()=>[_("原价购买")])),_:1})])),_:1})])),_:1})):y("",!0),I(S,{class:h(["ss-reset-button btn-box ss-flex-col",0!=Z.goodsInfo.stock?"check-btn-box":"disabled-btn-box"]),onClick:t[4]||(t[4]=s=>Z.showSelectSku=!0),disabled:0===Z.goodsInfo.stock},{default:u((()=>[I(g,{class:"price-box ss-flex"},{default:u((()=>[I(i,{src:p(e).$url.static("/static/img/shop/goods/score1.svg"),style:{width:"36rpx",height:"36rpx",margin:"0 4rpx"}},null,8,["src"]),I(n,{class:"point-text ss-m-r-16"},{default:u((()=>[_(v(Y.value.point)+" "+v(Y.value.price&&0!==Y.value.price?`+￥${Y.value.price}`:""),1)])),_:1})])),_:1}),0===Z.goodsInfo.stock?(k(),r(g,{key:0},{default:u((()=>[_("已售罄")])),_:1})):(k(),r(g,{key:1},{default:u((()=>[_("立即兑换")])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["modelValue"])],64))])),_:1},8,["onShareAppMessage"])}}},[["__scopeId","data-v-efe08830"]]);export{z as default};
