import{_ as s}from"./s-empty.SJwFoNXy.js";import{j as e,f as o,w as t,k as l,p as a,t as i,y as c,i as n,B as d,s as u,d as r,v as f,c as g,X as p,o as m,r as k,e as _,u as v,a6 as b,ap as I,S as y,l as x,g as w,A as S,aq as h,F as C,an as L,ao as j,G as T,H as P}from"./index-DugDUeNE.js";import{_ as A}from"./su-swiper.Divz1ojY.js";import{m as $,_ as E}from"./s-select-seckill-sku.CLRQxUT4.js";import{S as M}from"./s-layout.BR6uiIJz.js";import{e as U,f as V,u as D}from"./useGoods.EtUs43j4.js";import{d as R,a as q,_ as B,b as F,c as G,e as H}from"./detail-content-card.C_FE5cCh.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./su-number-box.DHhAzkhb.js";import"./comment-item.FYceYeoe.js";import"./uni-rate.DmEtwvCD.js";import"./su-image.CywDPG5U.js";import"./mp-html.UCcWV-JH.js";const z=N({__name:"detail-progress",props:{percent:{type:Number,default:0}},setup:s=>(d,u)=>{const r=n;return e(),o(r,{class:"ss-flex ss-col-center"},{default:t((()=>[l(r,{class:"progress-title ss-m-r-10"},{default:t((()=>[a(" 已抢"+i(s.percent)+"% ",1)])),_:1}),l(r,{class:"progress-box ss-flex ss-col-center"},{default:t((()=>[l(r,{class:"progerss-active",style:c({width:s.percent<10?"10%":s.percent+"%"})},null,8,["style"])])),_:1})])),_:1})}},[["__scopeId","data-v-71021f3c"]]),J=N({__name:"seckill",setup(c){d((s=>({"6f3669be":v(N),"6a250d35":v(J),"21ae5c19":v(K),"4c7c3348":v(O),"2bf58cf7":v(X)})));const N=u.$url.css("/static/img/shop/goods/seckill-bg.png"),J=u.$url.css("/static/img/shop/goods/seckill-btn.png"),K=u.$url.css("/static/img/shop/goods/activity-btn-disabled.png"),O=u.$url.css("/static/img/shop/goods/seckill-tip-bg.png"),X=u.$url.css("/static/img/shop/goods/groupon-tip-bg.png");r((()=>{}));const Z=f({skeletonLoading:!0,goodsInfo:{},showSelectSku:!1,goodsSwiper:[],selectedSku:{},showModel:!1,total:0,percent:0,price:""}),Q=g((()=>D(es.value.endTime)));function W(s){Z.selectedSku=s}function Y(s){u.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",buy_type:"seckill",seckillActivityId:es.value.id,items:[{skuId:s.id,count:s.count}]})})}const ss=g((()=>L(v(es))?{}:u.$platform.share.getShareInfo({title:es.value.name,image:u.$url.cdn(Z.goodsInfo.picUrl),params:{page:j.SECKILL.value,query:es.value.id}},{type:"goods",title:es.value.name,image:u.$url.cdn(Z.goodsInfo.picUrl),price:V(Z.goodsInfo.price),marketPrice:V(Z.goodsInfo.marketPrice)}))),es=p(),os=p(""),ts=async s=>{const{data:e}=await y.getSpuDetail(s);if(!e)return Z.goodsInfo=null,void(Z.skeletonLoading=!1);e.activity_type="seckill",Z.goodsInfo=e,Z.goodsSwiper=U(Z.goodsInfo.sliderPicUrls),Z.goodsInfo.price=$([Z.goodsInfo.price,...es.value.products.map((s=>s.seckillPrice))]),e.skus.forEach((s=>{const e=es.value.products.find((e=>e.skuId===s.id));e?(s.price=e.seckillPrice,s.stock=Math.min(s.stock,e.stock)):s.stock=0,es.value.totalLimitCount>0&&es.value.singleLimitCount>0?s.limitCount=Math.min(es.value.totalLimitCount,es.value.singleLimitCount):es.value.totalLimitCount>0?s.limitCount=es.value.totalLimitCount:es.value.singleLimitCount>0&&(s.limitCount=es.value.singleLimitCount)})),Z.skeletonLoading=!1};return m((s=>{if(!s.id)return Z.goodsInfo=null,void(Z.skeletonLoading=!1);(async s=>{const{data:e}=await b.getSeckillActivity(s);if(!e)return Z.goodsInfo=null,void(Z.skeletonLoading=!1);es.value=e,os.value=I(es.value.startTime,es.value.endTime),Z.percent=100-e.stock/e.totalStock*100,await ts(e.spuId)})(s.id)})),(c,d)=>{const r=k(_("s-empty"),s),f=k(_("su-swiper"),A),g=n,p=T,m=k(_("s-select-seckill-sku"),E),b=P,I=k(_("s-layout"),M);return e(),o(I,{onShareAppMessage:ss.value,navbar:"goods"},{default:t((()=>[l(R),Z.skeletonLoading?(e(),o(q,{key:0})):null===Z.goodsInfo||"seckill"!==Z.goodsInfo.activity_type||Q.value.ms<=0?(e(),o(r,{key:1,text:"活动不存在或已结束",icon:"/static/soldout-empty.png",showAction:"",actionText:"再逛逛",actionUrl:"/pages/goods/list"})):(e(),x(C,{key:2},[l(g,{class:"detail-swiper-selector"},{default:t((()=>[l(f,{class:"ss-m-b-14",isPreview:"",list:Z.goodsSwiper,dotStyle:"tag",imageMode:"widthFix",dotCur:"bg-mask-40",seizeHeight:750},null,8,["list"]),l(g,{class:"title-card ss-m-y-14 ss-m-x-20 ss-p-x-20 ss-p-y-34"},{default:t((()=>[l(g,{class:"price-box ss-flex ss-row-between ss-m-b-18"},{default:t((()=>[l(g,{class:"ss-flex"},{default:t((()=>[l(g,{class:"price-text ss-m-r-16"},{default:t((()=>[a(i(v(V)(Z.selectedSku.price||Z.goodsInfo.price)),1)])),_:1}),l(g,{class:"tig ss-flex ss-col-center"},{default:t((()=>[l(g,{class:"tig-icon ss-flex ss-col-center ss-row-center"},{default:t((()=>[l(p,{class:"cicon-alarm"})])),_:1}),l(g,{class:"tig-title"},{default:t((()=>[a("秒杀价")])),_:1})])),_:1})])),_:1}),Q.value.ms>0?(e(),o(g,{key:0,class:"countdown-box"},{default:t((()=>[l(g,{class:"countdown-title ss-m-b-20"},{default:t((()=>[a("距结束仅剩")])),_:1}),l(g,{class:"ss-flex countdown-time"},{default:t((()=>[l(g,{class:"ss-flex countdown-h"},{default:t((()=>[a(i(Q.value.h),1)])),_:1}),l(g,{class:"ss-m-x-4"},{default:t((()=>[a(":")])),_:1}),l(g,{class:"countdown-num ss-flex ss-row-center"},{default:t((()=>[a(i(Q.value.m),1)])),_:1}),l(g,{class:"ss-m-x-4"},{default:t((()=>[a(":")])),_:1}),l(g,{class:"countdown-num ss-flex ss-row-center"},{default:t((()=>[a(i(Q.value.s),1)])),_:1})])),_:1})])),_:1})):(e(),o(g,{key:1,class:"countdown-title"},{default:t((()=>[a(" 活动已结束 ")])),_:1}))])),_:1}),l(g,{class:"ss-flex ss-row-between ss-m-b-60"},{default:t((()=>[Z.goodsInfo.marketPrice?(e(),o(g,{key:0,class:"origin-price ss-flex ss-col-center"},{default:t((()=>[a(" 原价 "),l(g,{class:"origin-price-text"},{default:t((()=>[a(i(v(V)(Z.selectedSku.marketPrice||Z.goodsInfo.marketPrice)),1)])),_:1})])),_:1})):w("",!0),l(z,{percent:Z.percent},null,8,["percent"])])),_:1}),l(g,{class:"title-text ss-line-2 ss-m-b-6"},{default:t((()=>[a(i(Z.goodsInfo.name||""),1)])),_:1}),l(g,{class:"subtitle-text ss-line-1"},{default:t((()=>[a(i(Z.goodsInfo.introduction),1)])),_:1})])),_:1}),l(g,{class:"detail-cell-card detail-card ss-flex-col"},{default:t((()=>[l(B,{sku:Z.selectedSku,onClick:d[0]||(d[0]=s=>Z.showSelectSku=!0)},null,8,["sku"])])),_:1}),l(m,{modelValue:Z.goodsInfo,"onUpdate:modelValue":d[1]||(d[1]=s=>Z.goodsInfo=s),show:Z.showSelectSku,"single-limit-count":es.value.singleLimitCount,onBuy:Y,onChange:W,onClose:d[2]||(d[2]=s=>Z.showSelectSku=!1)},null,8,["modelValue","show","single-limit-count"])])),_:1}),l(F,{class:"detail-comment-selector",goodsId:Z.goodsInfo.id},null,8,["goodsId"]),l(G,{class:"detail-content-selector",content:Z.goodsInfo.description},null,8,["content"]),l(H,{modelValue:Z.goodsInfo,"onUpdate:modelValue":d[5]||(d[5]=s=>Z.goodsInfo=s)},{default:t((()=>[l(g,{class:"buy-box ss-flex ss-col-center ss-p-r-20"},{default:t((()=>[Z.goodsInfo.marketPrice?(e(),o(b,{key:0,class:"ss-reset-button origin-price-btn ss-flex-col",onClick:d[3]||(d[3]=s=>v(u).$router.go("/pages/goods/index",{id:Z.goodsInfo.id}))},{default:t((()=>[l(g,null,{default:t((()=>[l(g,{class:"btn-price"},{default:t((()=>[a(i(v(V)(Z.goodsInfo.marketPrice)),1)])),_:1}),l(g,null,{default:t((()=>[a("原价购买")])),_:1})])),_:1})])),_:1})):(e(),o(b,{key:1,class:"ss-reset-button origin-price-btn ss-flex-col"},{default:t((()=>[l(g,{class:S(["no-original",(0===Z.goodsInfo.stock||(os.value,v(h).STARTED),"")])},{default:t((()=>[a(" 秒杀价 ")])),_:1},8,["class"])])),_:1})),l(b,{class:S(["ss-reset-button btn-box ss-flex-col",os.value===v(h).STARTED&&0!=Z.goodsInfo.stock?"check-btn-box":"disabled-btn-box"]),onClick:d[4]||(d[4]=s=>Z.showSelectSku=!0),disabled:0===Z.goodsInfo.stock||os.value!==v(h).STARTED},{default:t((()=>[l(g,{class:"btn-price"},{default:t((()=>[a(i(v(V)(Z.goodsInfo.price)),1)])),_:1}),os.value===v(h).STARTED?(e(),o(g,{key:0},{default:t((()=>[0===Z.goodsInfo.stock?(e(),o(g,{key:0},{default:t((()=>[a("已售罄")])),_:1})):(e(),o(g,{key:1},{default:t((()=>[a("立即秒杀")])),_:1}))])),_:1})):(e(),o(g,{key:1},{default:t((()=>[a(i(os.value),1)])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["modelValue"])],64))])),_:1},8,["onShareAppMessage"])}}},[["__scopeId","data-v-74ee4b8c"]]);export{J as default};
