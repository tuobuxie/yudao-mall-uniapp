import{B as e,h as s,s as t,v as l,c as a,n as o,r as c,e as d,f as i,w as n,u as r,j as u,g as f,k as p,p as m,t as _,l as g,m as k,F as h,D as x,E as b,S as y,G as v,i as w,H as C,I as M,J as I,K as S}from"./index-DugDUeNE.js";import{_ as j}from"./s-empty.SJwFoNXy.js";import{_ as G}from"./su-number-box.DHhAzkhb.js";import{_ as $}from"./s-goods-item.CSZDjYya.js";import{_ as B,S as L}from"./s-layout.BR6uiIJz.js";import{f as A}from"./useGoods.EtUs43j4.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const E=T({__name:"cart",setup(T){e((e=>({"558f9e8a":r(E)}))),s({fail:()=>{}});const E=t.$platform.navbar,N=t.$store("cart"),V=l({editMode:a((()=>N.editMode)),list:a((()=>N.list)),selectedList:[],selectedIds:a((()=>N.selectedIds)),isAllSelected:a((()=>N.isAllSelected)),totalPriceSelected:a((()=>N.totalPriceSelected))});function F(e){N.selectSingle(e)}function P(e){N.onChangeEditMode(e)}function U(){N.selectAll(!V.isAllSelected)}async function J(){const e=[];V.selectedList=V.list.filter((e=>V.selectedIds.includes(e.id))),V.selectedList.map((s=>{e.push({skuId:s.sku.id,count:s.count,cartId:s.id,categoryId:s.spu.categoryId})})),b(e)?t.$helper.toast("请先选择商品"):(await async function(e){const{data:s}=await y.getSpuListByIds(e.join(","));if(b(s))throw t.$helper.toast("未找到商品信息"),new Error("未找到商品信息");const l=s.map((e=>e.deliveryTypes));if(function(e){for(let s=0;s<e.length-1;s++){const t=e[s];for(let l=s+1;l<e.length;l++){const s=e[l];if(!t.some((e=>s.includes(e))))return!0}}return!1}(l))throw t.$helper.toast("选中商品支持的配送方式冲突，不允许提交"),new Error("选中商品支持的配送方式冲突，不允许提交")}(V.selectedList.map((e=>e.spu)).map((e=>e.id))),t.$router.go("/pages/order/confirm",{data:JSON.stringify({items:e})}))}async function D(){N.delete(V.selectedIds)}return o((()=>{N.getList()})),(e,s)=>{const t=c(d("s-empty"),j),l=v,a=w,o=C,b=M,y=I,T=c(d("su-number-box"),G),E=c(d("s-goods-item"),$),H=c(d("su-fixed"),B),K=c(d("s-layout"),L);return u(),i(K,{bgStyle:{color:"#fff"},tabbar:"/pages/index/cart",title:"购物车"},{default:n((()=>[0===V.list.length?(u(),i(t,{key:0,icon:"/static/cart-empty.png",text:"购物车空空如也,快去逛逛吧~"})):f("",!0),V.list.length?(u(),i(a,{key:1,class:"cart-box ss-flex ss-flex-col ss-row-between"},{default:n((()=>[p(a,{class:"cart-header ss-flex ss-col-center ss-row-between ss-p-x-30"},{default:n((()=>[p(a,{class:"header-left ss-flex ss-col-center ss-font-26"},{default:n((()=>[m(" 共 "),p(l,{class:"goods-number ui-TC-Main ss-flex"},{default:n((()=>[m(_(V.list.length),1)])),_:1}),m(" 件商品 ")])),_:1}),p(a,{class:"header-right"},{default:n((()=>[V.editMode?(u(),i(o,{key:0,class:"ss-reset-button",onClick:s[0]||(s[0]=e=>P(!1))},{default:n((()=>[m(" 取消 ")])),_:1})):(u(),i(o,{key:1,class:"ss-reset-button ui-TC-Main",onClick:s[1]||(s[1]=e=>P(!0))},{default:n((()=>[m(" 编辑 ")])),_:1}))])),_:1})])),_:1}),p(a,{class:"cart-content ss-flex-1 ss-p-x-30 ss-m-b-40"},{default:n((()=>[(u(!0),g(h,null,k(V.list,(e=>(u(),i(a,{key:e.id,class:"goods-box ss-r-10 ss-m-b-14"},{default:n((()=>[p(a,{class:"ss-flex ss-col-center"},{default:n((()=>{var s,t;return[p(y,{class:"check-box ss-flex ss-col-center ss-p-l-10",onClick:s=>F(e.id)},{default:n((()=>[p(b,{checked:V.selectedIds.includes(e.id),color:"var(--ui-BG-Main)",style:{transform:"scale(0.8)"},onClick:x((s=>F(e.id)),["stop"])},null,8,["checked","onClick"])])),_:2},1032,["onClick"]),1===(null==(s=e.spu)?void 0:s.status)||V.editMode?(null==(t=e.spu)?void 0:t.stock)<=0&&!V.editMode?(u(),i(a,{key:1,class:"down-box"},{default:n((()=>[m(" 该商品无库存 ")])),_:1})):f("",!0):(u(),i(a,{key:0,class:"down-box"},{default:n((()=>[m(" 该商品已下架 ")])),_:1})),p(E,{img:e.spu.picUrl||e.goods.image,price:e.sku.price,skuText:e.sku.properties.length>1?e.sku.properties.reduce(((e,s)=>e.valueName+" "+s.valueName)):e.sku.properties[0].valueName,title:e.spu.name,titleWidth:400,priceColor:"#FF3000"},S({_:2},[V.editMode?void 0:{name:"tool",fn:n((()=>[p(T,{modelValue:e.count,"onUpdate:modelValue":s=>e.count=s,max:e.sku.stock,min:0,step:1,onChange:s=>{return l=e,void(0!==(t=s)?l.goods_num!==t&&(l.goods_num=t,N.update({goods_id:l.id,goods_num:t,goods_sku_price_id:l.goods_sku_price_id})):N.delete(l.id));var t,l}},null,8,["modelValue","onUpdate:modelValue","max","onChange"])])),key:"0"}]),1032,["img","price","skuText","title"])]})),_:2},1024)])),_:2},1024)))),128))])),_:1}),V.list.length>0?(u(),i(H,{key:0,isInset:!1,val:48,bottom:"",placeholder:""},{default:n((()=>[p(a,{class:"cart-footer ss-flex ss-col-center ss-row-between ss-p-x-30 border-bottom"},{default:n((()=>[p(a,{class:"footer-left ss-flex ss-col-center"},{default:n((()=>[p(y,{class:"check-box ss-flex ss-col-center ss-p-r-30",onClick:U},{default:n((()=>[p(b,{checked:V.isAllSelected,color:"var(--ui-BG-Main)",style:{transform:"scale(0.8)"},onClick:x(U,["stop"])},null,8,["checked"]),p(a,{class:"ss-m-l-8"},{default:n((()=>[m(" 全选")])),_:1})])),_:1}),p(l,null,{default:n((()=>[m("合计：")])),_:1}),p(a,{class:"text-price price-text"},{default:n((()=>[m(_(r(A)(V.totalPriceSelected)),1)])),_:1})])),_:1}),p(a,{class:"footer-right"},{default:n((()=>[V.editMode?(u(),i(o,{key:0,class:"ss-reset-button ui-BG-Main-Gradient pay-btn ui-Shadow-Main",onClick:D},{default:n((()=>[m(" 删除 ")])),_:1})):(u(),i(o,{key:1,class:"ss-reset-button ui-BG-Main-Gradient pay-btn ui-Shadow-Main",onClick:J},{default:n((()=>{var e;return[m(" 去结算 "+_((null==(e=V.selectedIds)?void 0:e.length)?`(${V.selectedIds.length})`:""),1)]})),_:1}))])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})):f("",!0)])),_:1})}}},[["__scopeId","data-v-4b2466c6"]]);export{E as default};
