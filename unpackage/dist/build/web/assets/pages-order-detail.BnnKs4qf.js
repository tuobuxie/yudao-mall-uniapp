import{v as e,X as s,r as t,e as a,j as r,f as o,w as l,k as d,p as i,y as n,g as c,u as f,s as u,t as p,aI as m,i as _,q as y,G as g,B as I,n as b,o as x,aJ as k,a4 as v,aK as h,l as w,m as S,F as $,P as C,an as T,H as P,D as O}from"./index-Ch_jkemp.js";import{_ as N}from"./s-goods-item.DcngbUKh.js";import{h as j,_ as q,S as U}from"./s-layout.Ckk_oEQ_.js";import{l as z,m as M,n as A,f as D}from"./useGoods.CmR2wUi_.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=R({__name:"pickUpVerify",props:{orderInfo:{type:Object,default(){}},systemStore:{type:Object,default(){}}},setup(I,{expose:b}){const x=I,k=e({qrcodeSize:145}),v=()=>{x.systemStore.latitude&&x.systemStore.longitude?m({latitude:x.systemStore.latitude,longitude:x.systemStore.longitude,scale:8,name:x.systemStore.name,address:x.systemStore.areaName+x.systemStore.detailAddress}):u.$helper.toast("缺少经纬度信息无法查看地图!")},h=s(),w=s(),S=s(!0),$=e=>{w.value=e,S.value=!1};return b({markCode:e=>{(async e=>{await h.value.render(e)})({css:{width:`${k.qrcodeSize}px`,height:`${k.qrcodeSize}px`},views:[{type:"qrcode",text:e,css:{width:`${k.qrcodeSize}px`,height:`${k.qrcodeSize}px`}}]})}}),(e,s)=>{const m=_,b=y,x=g,C=t(a("l-painter"),j);return r(),o(m,{class:"order-details"},{default:l((()=>[2===I.orderInfo.deliveryType&&I.orderInfo.payStatus?(r(),o(m,{key:0,class:"writeOff borRadius14"},{default:l((()=>[d(m,{class:"title"},{default:l((()=>[i("核销信息")])),_:1}),d(m,{class:"grayBg flex-center"},{default:l((()=>[d(m,{class:"pictrue"},{default:l((()=>[w.value?(r(),o(b,{key:0,src:w.value,style:n({width:`${k.qrcodeSize}px`,height:`${k.qrcodeSize}px`}),"show-menu-by-longpress":!0},null,8,["src","style"])):c("",!0)])),_:1})])),_:1}),d(m,{class:"gear"},{default:l((()=>[d(b,{src:f(u).$url.static("/static/img/shop/writeOff.png")},null,8,["src"])])),_:1}),d(m,{class:"num"},{default:l((()=>[i(p(I.orderInfo.pickUpVerifyCode),1)])),_:1}),d(m,{class:"rules"},{default:l((()=>[d(m,{class:"item"},{default:l((()=>[d(m,{class:"rulesTitle flex flex-wrap align-center"},{default:l((()=>[i(" 核销时间 ")])),_:1}),d(m,{class:"info"},{default:l((()=>[i(" 每日： "),d(x,{class:"time"},{default:l((()=>[i(p(I.systemStore.openingTime)+" - "+p(I.systemStore.closingTime),1)])),_:1})])),_:1})])),_:1}),d(m,{class:"item"},{default:l((()=>[d(m,{class:"rulesTitle flex flex-wrap align-center"},{default:l((()=>[d(x,{class:"iconfont icon-shuoming1"}),i(" 使用说明 ")])),_:1}),d(m,{class:"info"},{default:l((()=>[i("可将二维码出示给店员扫描或提供数字核销码")])),_:1})])),_:1})])),_:1})])),_:1})):c("",!0),2===I.orderInfo.deliveryType?(r(),o(m,{key:1,class:"map flex flex-wrap align-center ss-row-between borRadius14"},{default:l((()=>[d(m,null,{default:l((()=>[i("自提地址信息")])),_:1}),d(m,{class:"place cart-color flex flex-wrap flex-center",onClick:v},{default:l((()=>[i(" 查看位置 ")])),_:1})])),_:1})):c("",!0),S.value?(r(),o(C,{key:2,isCanvasToTempFilePath:"",pathType:"url",onSuccess:$,hidden:"",ref_key:"painterRef",ref:h},null,512)):c("",!0)])),_:1})}}},[["__scopeId","data-v-d743aeee"]]),F=R({__name:"detail",setup(m){I((e=>({"5414deb3":f(R)})));const j=2*u.$platform.device.statusBarHeight,R=u.$url.css("/static/img/shop/order/order_bg.png"),F=e({orderInfo:{}}),G=s({}),V=()=>{u.$helper.copyText(F.orderInfo.no)};const H=s();async function J(e){let s;if(s="wechat"===F.comeinType?await v.getOrderDetail(e,{merchant_trade_no:F.merchantTradeNo}):await v.getOrderDetail(e),0===s.code){if(F.orderInfo=s.data,z(F.orderInfo),s.data.pickUpStoreId){const{data:e}=await h.getDeliveryPickUpStore(s.data.pickUpStoreId);G.value=e||{}}2===F.orderInfo.deliveryType&&F.orderInfo.payStatus&&H.value&&H.value.markCode(s.data.pickUpVerifyCode)}else u.$router.back()}return b((async()=>{F.orderInfo.id&&await J(F.orderInfo.id)})),x((async e=>{var s;let t=0;if(e.id&&(t=e.id),!t&&e.payOrderNo){const a=await k.getOrder(void 0,void 0,e.payOrderNo);0===a.code&&(t=null==(s=a.data)?void 0:s.merchantOrderId)}F.orderInfo.id=t,await J(F.orderInfo.id)})),(e,s)=>{const m=y,I=_,b=g,x=P,k=t(a("s-goods-item"),N),h=t(a("su-fixed"),q),z=t(a("s-layout"),U);return r(),o(z,{title:"订单详情",class:"index-wrap",navbar:"inner"},{default:l((()=>{var e;return[d(I,{class:"state-box ss-flex-col ss-col-center ss-row-right",style:n([{marginTop:"-"+Number(j+88)+"rpx",paddingTop:Number(j+88)+"rpx"}])},{default:l((()=>[d(I,{class:"ss-flex ss-m-t-32 ss-m-b-20"},{default:l((()=>[0===F.orderInfo.status?(r(),o(m,{key:0,class:"state-img",src:f(u).$url.static("/static/img/shop/order/no_pay.png")},null,8,["src"])):c("",!0),10===F.orderInfo.status?(r(),o(m,{key:1,class:"state-img",src:f(u).$url.static("/static/img/shop/order/order_loading.png")},null,8,["src"])):30===F.orderInfo.status?(r(),o(m,{key:2,class:"state-img",src:f(u).$url.static("/static/img/shop/order/order_success.png")},null,8,["src"])):40===F.orderInfo.status?(r(),o(m,{key:3,class:"state-img",src:f(u).$url.static("/static/img/shop/order/order_close.png")},null,8,["src"])):20===F.orderInfo.status?(r(),o(m,{key:4,class:"state-img",src:f(u).$url.static("/static/img/shop/order/order_express.png")},null,8,["src"])):c("",!0),d(I,{class:"ss-font-30"},{default:l((()=>[i(p(f(M)(F.orderInfo)),1)])),_:1})])),_:1}),d(I,{class:"ss-font-26 ss-m-x-20 ss-m-b-70"},{default:l((()=>[i(p(f(A)(F.orderInfo)),1)])),_:1})])),_:1},8,["style"]),F.orderInfo.receiverAreaId>0?(r(),o(I,{key:0,class:"order-address-box"},{default:l((()=>[d(I,{class:"ss-flex ss-col-center"},{default:l((()=>[d(b,{class:"address-username"},{default:l((()=>[i(p(F.orderInfo.receiverName),1)])),_:1}),d(b,{class:"address-phone"},{default:l((()=>[i(p(F.orderInfo.receiverMobile),1)])),_:1})])),_:1}),d(I,{class:"address-detail"},{default:l((()=>[i(p(F.orderInfo.receiverAreaName)+" "+p(F.orderInfo.receiverDetailAddress),1)])),_:1})])),_:1})):c("",!0),d(I,{class:"detail-goods",style:n([{marginTop:F.orderInfo.receiverAreaId>0?"0":"-40rpx"}])},{default:l((()=>[(r(!0),w($,null,S(F.orderInfo.items,(e=>(r(),o(I,{class:"order-list",key:e.goods_id},{default:l((()=>[d(I,{class:"order-card"},{default:l((()=>[d(k,{onClick:s=>{return t=e.spuId,void u.$router.go("/pages/goods/index",{id:t});var t},img:e.picUrl,title:e.spuName,skuText:e.properties.map((e=>e.valueName)).join(" "),price:e.price,num:e.count},{tool:l((()=>[d(I,{class:"ss-flex"},{default:l((()=>[[10,20,30].includes(F.orderInfo.status)&&0===e.afterSaleStatus?(r(),o(x,{key:0,class:"ss-reset-button apply-btn",onClick:O((s=>f(u).$router.go("/pages/order/aftersale/apply",{orderId:F.orderInfo.id,itemId:e.id})),["stop"])},{default:l((()=>[i(" 申请售后 ")])),_:2},1032,["onClick"])):c("",!0),10===e.afterSaleStatus?(r(),o(x,{key:1,class:"ss-reset-button apply-btn",onClick:O((s=>f(u).$router.go("/pages/order/aftersale/detail",{id:e.afterSaleId})),["stop"])},{default:l((()=>[i(" 退款中 ")])),_:2},1032,["onClick"])):c("",!0),20===e.afterSaleStatus?(r(),o(x,{key:2,class:"ss-reset-button apply-btn",onClick:O((s=>f(u).$router.go("/pages/order/aftersale/detail",{id:e.afterSaleId})),["stop"])},{default:l((()=>[i(" 退款成功 ")])),_:2},1032,["onClick"])):c("",!0)])),_:2},1024)])),priceSuffix:l((()=>[e.status_text?(r(),o(x,{key:0,class:"ss-reset-button tag-btn"},{default:l((()=>[i(p(e.status_text),1)])),_:2},1024)):c("",!0)])),_:2},1032,["onClick","img","title","skuText","price","num"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["style"]),d(B,{"order-info":F.orderInfo,systemStore:G.value,ref_key:"pickUpVerifyRef",ref:H},null,8,["order-info","systemStore"]),d(I,{class:"notice-box"},{default:l((()=>[d(I,{class:"notice-box__content"},{default:l((()=>[d(I,{class:"notice-item--center"},{default:l((()=>[d(I,{class:"ss-flex ss-flex-1"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("订单编号：")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i(p(F.orderInfo.no),1)])),_:1})])),_:1}),d(x,{class:"ss-reset-button copy-btn",onClick:V},{default:l((()=>[i("复制")])),_:1})])),_:1}),d(I,{class:"notice-item"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("下单时间：")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i(p(f(u).$helper.timeFormat(F.orderInfo.createTime,"yyyy-mm-dd hh:MM:ss")),1)])),_:1})])),_:1}),F.orderInfo.payTime?(r(),o(I,{key:0,class:"notice-item"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("支付时间：")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i(p(f(u).$helper.timeFormat(F.orderInfo.payTime,"yyyy-mm-dd hh:MM:ss")),1)])),_:1})])),_:1})):c("",!0),d(I,{class:"notice-item"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("支付方式：")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i(p(F.orderInfo.payChannelName||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(I,{class:"order-price-box"},{default:l((()=>[d(I,{class:"notice-item ss-flex ss-row-between"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("商品总额")])),_:1}),d(I,{class:"ss-flex"},{default:l((()=>[d(b,{class:"detail"},{default:l((()=>[i("￥"+p(f(D)(F.orderInfo.totalPrice)),1)])),_:1})])),_:1})])),_:1}),d(I,{class:"notice-item ss-flex ss-row-between"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("运费")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i("￥"+p(f(D)(F.orderInfo.deliveryPrice)),1)])),_:1})])),_:1}),F.orderInfo.couponPrice>0?(r(),o(I,{key:0,class:"notice-item ss-flex ss-row-between"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("优惠劵金额")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i("-¥"+p(f(D)(F.orderInfo.couponPrice)),1)])),_:1})])),_:1})):c("",!0),F.orderInfo.pointPrice>0?(r(),o(I,{key:1,class:"notice-item ss-flex ss-row-between"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("积分抵扣")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i("-¥"+p(f(D)(F.orderInfo.pointPrice)),1)])),_:1})])),_:1})):c("",!0),F.orderInfo.discountPrice>0?(r(),o(I,{key:2,class:"notice-item ss-flex ss-row-between"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("活动优惠")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i("¥"+p(f(D)(F.orderInfo.discountPrice)),1)])),_:1})])),_:1})):c("",!0),F.orderInfo.vipPrice>0?(r(),o(I,{key:3,class:"notice-item ss-flex ss-row-between"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("会员优惠")])),_:1}),d(b,{class:"detail"},{default:l((()=>[i("-¥"+p(f(D)(F.orderInfo.vipPrice)),1)])),_:1})])),_:1})):c("",!0),d(I,{class:"notice-item all-rpice-item ss-flex ss-m-t-20"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i(p(F.orderInfo.payStatus?"已付款":"需付款"),1)])),_:1}),d(b,{class:"detail all-price"},{default:l((()=>[i("￥"+p(f(D)(F.orderInfo.payPrice)),1)])),_:1})])),_:1}),F.orderInfo.refundPrice>0?(r(),o(I,{key:4,class:"notice-item all-rpice-item ss-flex ss-m-t-20"},{default:l((()=>[d(b,{class:"title"},{default:l((()=>[i("已退款")])),_:1}),d(b,{class:"detail all-price"},{default:l((()=>[i("￥"+p(f(D)(F.orderInfo.refundPrice)),1)])),_:1})])),_:1})):c("",!0)])),_:1}),(null==(e=F.orderInfo.buttons)?void 0:e.length)?(r(),o(h,{key:1,bottom:"",placeholder:"",bg:"bg-white"},{default:l((()=>[d(I,{class:"footer-box ss-flex ss-col-center ss-row-right"},{default:l((()=>{var e,t,a,d,n,p;return[(null==(e=F.orderInfo.buttons)?void 0:e.includes("cancel"))?(r(),o(x,{key:0,class:"ss-reset-button cancel-btn",onClick:s[0]||(s[0]=e=>async function(e){C({title:"提示",content:"确定要取消订单吗?",success:async function(s){if(!s.confirm)return;const{code:t}=await v.cancelOrder(e);0===t&&await J(e)}})}(F.orderInfo.id))},{default:l((()=>[i(" 取消订单 ")])),_:1})):c("",!0),(null==(t=F.orderInfo.buttons)?void 0:t.includes("pay"))?(r(),o(x,{key:1,class:"ss-reset-button pay-btn ui-BG-Main-Gradient",onClick:s[1]||(s[1]=e=>{return s=F.orderInfo.payOrderId,void u.$router.go("/pages/pay/index",{id:s});var s})},{default:l((()=>[i(" 继续支付 ")])),_:1})):c("",!0),(null==(a=F.orderInfo.buttons)?void 0:a.includes("combination"))?(r(),o(x,{key:2,class:"ss-reset-button cancel-btn",onClick:s[2]||(s[2]=e=>f(u).$router.go("/pages/activity/groupon/detail",{id:F.orderInfo.combinationRecordId}))},{default:l((()=>[i(" 拼团详情 ")])),_:1})):c("",!0),(null==(d=F.orderInfo.buttons)?void 0:d.includes("express"))?(r(),o(x,{key:3,class:"ss-reset-button cancel-btn",onClick:s[3]||(s[3]=e=>async function(e){u.$router.go("/pages/order/express/log",{id:e})}(F.orderInfo.id))},{default:l((()=>[i(" 查看物流 ")])),_:1})):c("",!0),(null==(n=F.orderInfo.buttons)?void 0:n.includes("confirm"))?(r(),o(x,{key:4,class:"ss-reset-button cancel-btn",onClick:s[4]||(s[4]=e=>async function(e,s=!1){"WechatMiniProgram"!==u.$platform.name||T(F.orderInfo.wechat_extra_data)||s?C({title:"提示",content:"确认收货吗？",success:async function(s){if(!s.confirm)return;const{code:t}=await v.receiveOrder(e);0===t&&await J(e)}}):mpConfirm(e)}(F.orderInfo.id))},{default:l((()=>[i(" 确认收货 ")])),_:1})):c("",!0),(null==(p=F.orderInfo.buttons)?void 0:p.includes("comment"))?(r(),o(x,{key:5,class:"ss-reset-button cancel-btn",onClick:s[5]||(s[5]=e=>{return s=F.orderInfo.id,void u.$router.go("/pages/goods/comment/add",{id:s});var s})},{default:l((()=>[i(" 评价 ")])),_:1})):c("",!0)]})),_:1})])),_:1})):c("",!0)]})),_:1})}}},[["__scopeId","data-v-7834d0fc"]]);export{F as default};
