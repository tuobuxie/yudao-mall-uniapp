import{c as s,v as e,o as a,s as t,r as l,e as o,f as r,w as d,aJ as n,cr as c,cs as u,j as i,k as p,p as f,t as y,u as m,l as b,m as _,F as x,A as h,P as v,ct as I,G as S,i as g,aQ as $,H as k,g as w,q as T,I as j,J as C}from"./index-kPUodEo8.js";import{S as M}from"./s-layout.ChN2kRO2.js";import{f as F,u as G}from"./useGoods.CNv-03RG.js";import{_ as W}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=W({__name:"index",setup(W){const A=s((()=>t.$store("user").userWallet)),J=e({orderType:"goods",orderInfo:{},payStatus:0,payMethods:[],payment:""}),O=()=>{""!==J.payment?"wallet"===J.payment?v({title:"提示",content:"确定要支付吗?",success:function(s){s.confirm&&t.$platform.pay(J.payment,J.orderType,J.orderInfo.id)}}):t.$platform.pay(J.payment,J.orderType,J.orderInfo.id):t.$helper.toast("请选择支付方式")},P=s((()=>{if(2===J.payStatus)return"该订单已支付";if(1===J.payStatus){const s=G(J.orderInfo.expireTime);return s.ms<=0?(J.payStatus=-1,""):`剩余支付时间 ${s.h}:${s.m}:${s.s} `}return-2===J.payStatus?"未查询到支付单信息":""}));function q(s){J.payment=s.detail.value}async function B(s){const{data:e,code:a}=await n.getOrder(s,!0);0===a&&e?(J.orderInfo=e,function(){if(10===J.orderInfo.status||20===J.orderInfo.status)return J.payStatus=2,void v({title:"提示",content:"订单已支付",showCancel:!1,success:function(){I(J.orderInfo.id,J.orderType)}});30!==J.orderInfo.status?J.payStatus=1:J.payStatus=-1}(),await async function(){const{data:s,code:e}=await c.getEnableChannelCodeList(J.orderInfo.appId);if(0!==e)return;J.payMethods=u(s),J.payMethods.find((s=>{if(s.value&&!s.disabled)return J.payment=s.value,!0}))}()):J.payStatus=-2}return a((s=>{if("WechatOfficialAccount"===t.$platform.name&&"ios"===t.$platform.os&&!t.$platform.landingPage.includes("pages/pay/index"))return void location.reload();let e=s.id;s.orderType&&(J.orderType=s.orderType),B(e),t.$store("user").getWallet()})),(s,e)=>{const a=S,n=g,c=T,u=j,v=C,I=$,G=k,W=l(o("s-layout"),M);return i(),r(W,{title:"收银台"},{default:d((()=>[p(n,{class:"bg-white ss-modal-box ss-flex-col"},{default:d((()=>[p(n,{class:"modal-header ss-flex-col ss-col-center ss-row-center"},{default:d((()=>[p(n,{class:"money-box ss-m-b-20"},{default:d((()=>[p(a,{class:"money-text"},{default:d((()=>[f(y(m(F)(J.orderInfo.price)),1)])),_:1})])),_:1}),p(n,{class:"time-text"},{default:d((()=>[p(a,null,{default:d((()=>[f(y(P.value),1)])),_:1})])),_:1})])),_:1}),p(n,{class:"modal-content ss-flex-1"},{default:d((()=>[p(n,{class:"pay-title ss-p-l-30 ss-m-y-30"},{default:d((()=>[f("选择支付方式")])),_:1}),p(I,{onChange:q},{default:d((()=>[(i(!0),b(x,null,_(J.payMethods,(s=>(i(),r(v,{class:"pay-type-item",key:s.title},{default:d((()=>[p(n,{class:h(["pay-item ss-flex ss-col-center ss-row-between ss-p-x-30 border-bottom",{"disabled-pay-item":s.disabled}])},{default:d((()=>[p(n,{class:"ss-flex ss-col-center"},{default:d((()=>[s.disabled?(i(),r(c,{key:0,class:"pay-icon",src:m(t).$url.static("/static/img/shop/pay/cod_disabled.png"),mode:"aspectFit"},null,8,["src"])):(i(),r(c,{key:1,class:"pay-icon",src:m(t).$url.static(s.icon),mode:"aspectFit"},null,8,["src"])),p(a,{class:"pay-title"},{default:d((()=>[f(y(s.title),1)])),_:2},1024)])),_:2},1024),p(n,{class:"check-box ss-flex ss-col-center ss-p-l-10"},{default:d((()=>["wallet"===s.value?(i(),r(n,{key:0,class:"userInfo-money ss-m-r-10"},{default:d((()=>[f(" 余额: "+y(m(F)(A.value.balance))+"元 ",1)])),_:1})):w("",!0),p(u,{value:s.value,color:"var(--ui-BG-Main)",style:{transform:"scale(0.8)"},disabled:s.disabled,checked:J.payment===s.value},null,8,["value","disabled","checked"])])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1})])),_:1}),p(n,{class:"modal-footer ss-flex ss-row-center ss-col-center ss-m-t-80 ss-m-b-40"},{default:d((()=>[0===J.payStatus?(i(),r(G,{key:0,class:"ss-reset-button past-due-btn"},{default:d((()=>[f(" 检测支付环境中 ")])),_:1})):-1===J.payStatus?(i(),r(G,{key:1,class:"ss-reset-button past-due-btn",disabled:""},{default:d((()=>[f(" 支付已过期 ")])),_:1})):(i(),r(G,{key:2,class:h(["ss-reset-button save-btn",{"disabled-btn":1!==J.payStatus}]),onClick:O,disabled:1!==J.payStatus},{default:d((()=>[f(" 立即支付 ")])),_:1},8,["disabled","class"]))])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-56c40a6b"]]);export{A as default};
