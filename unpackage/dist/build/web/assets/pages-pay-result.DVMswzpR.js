import{v as e,c as s,o as t,n as r,an as a,cu as o,r as l,e as c,f as d,w as u,aJ as i,a4 as n,j as f,k as p,g as y,u as g,s as m,p as _,t as b,P as k,i as v,q as x,H as T}from"./index-DugDUeNE.js";import{S as w}from"./s-layout.BR6uiIJz.js";import{f as I}from"./useGoods.EtUs43j4.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=h({__name:"result",setup(h){const $=e({id:0,orderType:"goods",result:"unpaid",orderInfo:{},tradeOrder:{},counter:0}),O=s((()=>"unpaid"===$.result?"waiting":"paid"===$.result?"success":"failed"===$.result?"failed":"closed"===$.result?"closed":void 0));async function j(e){$.counter++;const{data:s,code:t}=await i.getOrder(e,!0);if(0===t){if($.orderInfo=s,!$.orderInfo||30===$.orderInfo.status)return void($.result="closed");if(0!==$.orderInfo.status){if($.result="paid","goods"===$.orderType){const{data:e,code:s}=await n.getOrderDetail($.orderInfo.merchantOrderId,!0);0===s&&($.tradeOrder=e)}return}}$.counter<5&&"unpaid"===$.result&&setTimeout((()=>{j(e)}),2e3),$.counter>=5&&($.result="failed","failed"===$.result&&k({title:"确认支付",content:"未检测到您的支付结果,请确认您是否已经支付完成？",cancelText:"取消",confirmText:"我已支付",success:function(e){e.confirm&&($.counter=0,setTimeout((()=>{j($.id)}),100))}}))}function C(){"recharge"===$.orderType?m.$router.redirect("/pages/pay/recharge-log"):m.$router.redirect("/pages/order/list")}return t((async e=>{e.id&&($.id=e.id),e.orderType&&($.orderType=e.orderType),"fail"===e.payState?$.result="failed":await j($.id)})),r((()=>{a($.orderInfo)||j($.id)})),o((()=>{$.result="unpaid",$.counter=0})),(e,s)=>{const t=v,r=x,a=T,o=l(c("s-layout"),w);return f(),d(o,{bgStyle:{color:"#FFF"},title:"支付结果"},{default:u((()=>[p(t,{class:"pay-result-box ss-flex-col ss-row-center ss-col-center"},{default:u((()=>["waiting"===O.value?(f(),d(t,{key:0,class:"pay-waiting ss-m-b-30"})):y("",!0),"success"===O.value?(f(),d(r,{key:1,class:"pay-img ss-m-b-30",src:g(m).$url.static("/static/img/shop/order/order_pay_success.gif")},null,8,["src"])):y("",!0),["failed","closed"].includes(O.value)?(f(),d(r,{key:2,class:"pay-img ss-m-b-30",src:g(m).$url.static("/static/img/shop/order/order_paty_fail.gif")},null,8,["src"])):y("",!0),"success"===O.value?(f(),d(t,{key:3,class:"tip-text ss-m-b-30"},{default:u((()=>[_("支付成功")])),_:1})):y("",!0),"failed"===O.value?(f(),d(t,{key:4,class:"tip-text ss-m-b-30"},{default:u((()=>[_("支付失败")])),_:1})):y("",!0),"closed"===O.value?(f(),d(t,{key:5,class:"tip-text ss-m-b-30"},{default:u((()=>[_("该订单已关闭")])),_:1})):y("",!0),"waiting"===O.value?(f(),d(t,{key:6,class:"tip-text ss-m-b-30"},{default:u((()=>[_("正在查询支付结果...")])),_:1})):y("",!0),"success"===O.value?(f(),d(t,{key:7,class:"pay-total-num ss-flex"},{default:u((()=>[p(t,null,{default:u((()=>[_("￥"+b(g(I)($.orderInfo.price)),1)])),_:1})])),_:1})):y("",!0),p(t,{class:"btn-box ss-flex ss-row-center ss-m-t-50"},{default:u((()=>[p(a,{class:"back-btn ss-reset-button",onClick:s[0]||(s[0]=e=>g(m).$router.go("/pages/index/index"))},{default:u((()=>[_(" 返回首页 ")])),_:1}),"failed"===O.value?(f(),d(a,{key:0,class:"check-btn ss-reset-button",onClick:s[1]||(s[1]=e=>g(m).$router.redirect("/pages/pay/index",{id:$.id,orderType:$.orderType}))},{default:u((()=>[_(" 重新支付 ")])),_:1})):y("",!0),"success"===O.value?(f(),d(a,{key:1,class:"check-btn ss-reset-button",onClick:C},{default:u((()=>[_(" 查看订单 ")])),_:1})):y("",!0),"success"===O.value&&3===$.tradeOrder.type?(f(),d(a,{key:2,class:"check-btn ss-reset-button",onClick:s[2]||(s[2]=e=>g(m).$router.redirect("/pages/activity/groupon/order"))},{default:u((()=>[_(" 我的拼团 ")])),_:1})):y("",!0)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-7bf317c3"]]);export{$ as default};
