import{B as e,u as s,s as t,v as l,c as o,aj as r,r as a,e as c,j as u,f as n,w as d,k as i,p as f,t as p,l as m,F as g,m as _,A as k,g as b,q as y,i as x,H as h,z as S}from"./index-DugDUeNE.js";import{_ as v}from"./su-number-box.DHhAzkhb.js";import{c as w}from"./s-layout.BR6uiIJz.js";import{c as A,f as j}from"./useGoods.EtUs43j4.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=P({__name:"s-select-groupon-sku",props:{show:{type:Boolean,default:!1},goodsInfo:{type:Object,default(){}},grouponAction:{type:String,default:"create"},grouponNum:{type:[Number,String],default:0}},emits:["change","addCart","buy","close","ladder"],setup(P,{emit:I}){e((e=>({"52af2851":s(O)})));const O=t.$url.css("/static/img/shop/goods/groupon-btn-long.png"),C=I,N=P,$=l({selectedSku:{},currentPropertyArray:{},grouponNum:N.grouponNum}),E=A(N.goodsInfo.skus),U=o((()=>{let e=N.goodsInfo.skus;for(let s of e)s.value_id_array=s.properties.map((e=>e.valueId));return e}));function V(){!$.selectedSku.id||$.selectedSku.id<=0?t.$helper.toast("请选择规格"):$.selectedSku.stock<=0?t.$helper.toast("库存不足"):C("buy",$.selectedSku)}function B(e=!1,s=0,t=0){let l=[];if(e)for(let a of U.value)a.stock<=0||a.value_id_array.indexOf(t)>=0&&l.push(a);else l=F();let o=[];for(let a of l)o=o.concat(a.value_id_array);if(o=Array.from(new Set(o)),e){let e=o.indexOf(t);o.splice(e,1)}else Object.entries($.currentPropertyArray).forEach((([e,s])=>{if(""!==s.toString())return;let t=o.indexOf(s);t>=0&&o.splice(t,1)}));let r=[];e?r=[s]:Object.entries($.currentPropertyArray).forEach((([e,s])=>{""!==s&&r.push(s)}));for(let a in E)if(!(r.indexOf(E[a].id)>=0))for(let e in E[a].values)E[a].values[e].disabled=o.indexOf(E[a].values[e].id)<0}function F(){let e=[];for(let s of U.value){if(s.stock<=0)continue;let t=!0;Object.entries($.currentPropertyArray).forEach((([e,l])=>{""!==l.toString()&&s.value_id_array.indexOf(l)<0&&(t=!1)})),t&&e.push(s)}return e}return r((()=>$.selectedSku),(e=>{C("change",e)}),{immediate:!0,deep:!0}),B(!1),(e,l)=>{const o=y,r=x,A=h,I=a(c("su-number-box"),v),O=S,N=a(c("su-popup"),w);return u(),n(N,{show:P.show,round:"10",onClose:l[2]||(l[2]=e=>C("close"))},{default:d((()=>[i(r,{class:"ss-modal-box bg-white ss-flex-col"},{default:d((()=>[i(r,{class:"modal-header ss-flex ss-col-center"},{default:d((()=>[i(r,{class:"header-left ss-m-r-30"},{default:d((()=>[i(o,{class:"sku-image",src:s(t).$url.cdn($.selectedSku.picUrl||P.goodsInfo.picUrl),mode:"aspectFill"},null,8,["src"])])),_:1}),i(r,{class:"header-right ss-flex-col ss-row-between ss-flex-1"},{default:d((()=>[i(r,{class:"goods-title ss-line-2"},{default:d((()=>[i(r,{class:"tig ss-flex ss-col-center"},{default:d((()=>[i(r,{class:"tig-icon ss-flex ss-col-center ss-row-center"},{default:d((()=>[i(r,{class:"groupon-tag"},{default:d((()=>[i(o,{src:s(t).$url.static("/static/img/shop/goods/groupon-tag-white.png")},null,8,["src"])])),_:1})])),_:1}),i(r,{class:"tig-title"},{default:d((()=>[f("拼团价")])),_:1})])),_:1}),i(r,{class:"info-title"},{default:d((()=>[f(p(P.goodsInfo.name),1)])),_:1})])),_:1}),i(r,{class:"header-right-bottom ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(r,{class:"price-text"},{default:d((()=>[f(p(s(j)($.selectedSku.price||P.goodsInfo.price||$.selectedSku.marketPrice)),1)])),_:1}),i(r,{class:"stock-text ss-m-l-20"},{default:d((()=>[f(" 库存"+p($.selectedSku.stock||P.goodsInfo.stock)+"件 ",1)])),_:1})])),_:1})])),_:1})])),_:1}),i(r,{class:"modal-content ss-flex-1"},{default:d((()=>[i(O,{"scroll-y":"true",class:"modal-content-scroll"},{default:d((()=>[(u(!0),m(g,null,_(s(E),(e=>(u(),n(r,{class:"sku-item ss-m-b-20",key:e.id},{default:d((()=>[i(r,{class:"label-text ss-m-b-20"},{default:d((()=>[f(p(e.name),1)])),_:2},1024),i(r,{class:"ss-flex ss-col-center ss-flex-wrap"},{default:d((()=>[(u(!0),m(g,null,_(e.values,(s=>(u(),n(A,{class:k(["ss-reset-button spec-btn",[{"checked-btn":$.currentPropertyArray[e.id]===s.id},{"disabled-btn":!0===s.disabled}]]),key:s.id,disabled:!0===s.disabled,onClick:t=>function(e,s){let t=!0;void 0!==$.currentPropertyArray[e]&&$.currentPropertyArray[e]===s?(t=!1,$.currentPropertyArray.splice(e,1,"")):$.currentPropertyArray[e]=s;let l=[];Object.entries($.currentPropertyArray).forEach((([e,s])=>{""!==s&&l.push(s)}));let o=F();l.length===E.length&&o.length?(o[0].count=$.selectedSku.count||1,$.selectedSku=o[0]):$.selectedSku={},B(t,e,s)}(e.id,s.id)},{default:d((()=>[f(p(s.name),1)])),_:2},1032,["class","disabled","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)),i(r,{class:"buy-num-box ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(r,{class:"label-text"},{default:d((()=>[f("购买数量")])),_:1}),i(I,{min:1,max:$.selectedSku.stock,step:1,modelValue:$.selectedSku.count,"onUpdate:modelValue":l[0]||(l[0]=e=>$.selectedSku.count=e),onChange:l[1]||(l[1]=e=>{var s;0!==(s=e)&&$.selectedSku.count!==s&&($.selectedSku.count=s)}),activity:"groupon"},null,8,["max","modelValue"])])),_:1})])),_:1})])),_:1}),i(r,{class:"modal-footer ss-p-y-20"},{default:d((()=>[i(r,{class:"buy-box ss-flex ss-col-center ss-flex ss-col-center ss-row-center"},{default:d((()=>[i(r,{class:"ss-flex"},{default:d((()=>[i(A,{class:"ss-reset-button origin-price-btn ss-flex-col"},{default:d((()=>[i(r,{class:"btn-title"},{default:d((()=>[f(p(P.grouponNum+"人团"),1)])),_:1})])),_:1}),i(A,{class:"ss-reset-button btn-tox ss-flex-col",onClick:V},{default:d((()=>[i(r,{class:"btn-price"},{default:d((()=>[f(p(s(j)($.selectedSku.price*$.selectedSku.count||P.goodsInfo.price*$.selectedSku.count||$.selectedSku.marketPrice*$.selectedSku.count||P.goodsInfo.price)),1)])),_:1}),"create"===P.grouponAction?(u(),n(r,{key:0},{default:d((()=>[f("立即开团")])),_:1})):"join"===P.grouponAction?(u(),n(r,{key:1},{default:d((()=>[f("参与拼团")])),_:1})):b("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-7ec088e3"]]);export{I as _};
