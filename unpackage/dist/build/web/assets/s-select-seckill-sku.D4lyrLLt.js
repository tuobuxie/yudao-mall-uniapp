import{ar as e,v as s,c as t,an as l,aj as a,r,e as o,j as c,f as u,w as n,k as d,u as i,s as f,p,t as m,a7 as y,g as _,l as k,F as b,m as x,A as g,q as h,i as v,G as S,H as w,z as P}from"./index-Ch_jkemp.js";import{_ as j}from"./su-number-box.XmnqyQW5.js";import{c as A}from"./s-layout.Ckk_oEQ_.js";import{f as I,c as O}from"./useGoods.CmR2wUi_.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";function $(e){return e}function V(e,s){return e<s}function E(s){return s&&s.length?function(s,t,l){for(var a=-1,r=s.length;++a<r;){var o=s[a],c=t(o);if(null!=c&&(void 0===u?c==c&&!e(c):l(c,u)))var u=c,n=o}return n}(s,$,V):void 0}const U=C({__name:"s-select-seckill-sku",props:{modelValue:{type:Object,default(){}},show:{type:Boolean,default:!1},singleLimitCount:{type:Number,default:1}},emits:["change","addCart","buy","close"],setup(e,{emit:C}){const $=C,V=e,U=s({goodsInfo:t((()=>V.modelValue)),selectedSku:{},currentPropertyArray:{}}),F=t((()=>{let e=`￥${I(U.goodsInfo.price)}`;if(!l(U.selectedSku)){const s=U.selectedSku;e=`${s.point}${s.pointPrice?`+￥${I(s.pointPrice)}`:""}`}return e})),G=O(U.goodsInfo.skus),L=t((()=>{let e=U.goodsInfo.skus;for(let s of e)s.value_id_array=s.properties.map((e=>e.valueId));return e}));a((()=>U.selectedSku),(e=>{$("change",e)}),{immediate:!0,deep:!0});const N=()=>{U.selectedSku.id?U.selectedSku.stock<=0?f.$helper.toast("库存不足"):$("buy",U.selectedSku):f.$helper.toast("请选择规格")};const q=(e=!1,s=0,t=0)=>{let l=[];if(e)for(let o of L.value)o.stock<=0||o.value_id_array.indexOf(t)>=0&&l.push(o);else l=z();let a=[];for(let o of l)a=a.concat(o.value_id_array);if(a=Array.from(new Set(a)),e){let e=a.indexOf(t);a.splice(e,1)}else Object.entries(U.currentPropertyArray).forEach((([e,s])=>{if(""!==s.toString())return;let t=a.indexOf(s);t>=0&&a.splice(t,1)}));let r=[];e?r=[s]:Object.entries(U.currentPropertyArray).forEach((([e,s])=>{""!==s&&r.push(s)}));for(let o in G)if(!(r.indexOf(G[o].id)>=0))for(let e in G[o].values)G[o].values[e].disabled=a.indexOf(G[o].values[e].id)<0},z=()=>{let e=[];for(let s of L.value){if(s.stock<=0)continue;let t=!0;Object.entries(U.currentPropertyArray).forEach((([e,l])=>{""!==l.toString()&&s.value_id_array.indexOf(l)<0&&(t=!1)})),t&&e.push(s)}return e};return q(!1),(s,t)=>{const a=h,O=v,C=S,V=w,L=r(o("su-number-box"),j),B=P,H=r(o("su-popup"),A);return c(),u(H,{show:e.show,round:"10",onClose:t[2]||(t[2]=e=>$("close"))},{default:n((()=>[d(O,{class:"ss-modal-box bg-white ss-flex-col"},{default:n((()=>[d(O,{class:"modal-header ss-flex ss-col-center"},{default:n((()=>[d(O,{class:"header-left ss-m-r-30"},{default:n((()=>[d(a,{class:"sku-image",src:i(f).$url.cdn(U.selectedSku.picUrl||U.goodsInfo.picUrl),mode:"aspectFill"},null,8,["src"])])),_:1}),d(O,{class:"header-right ss-flex-col ss-row-between ss-flex-1"},{default:n((()=>[d(O,{class:"goods-title ss-line-2"},{default:n((()=>[p(m(U.goodsInfo.name),1)])),_:1}),d(O,{class:"header-right-bottom ss-flex ss-col-center ss-row-between"},{default:n((()=>[U.goodsInfo.activity_type===i(y).POINT.type?(c(),u(O,{key:0,class:"price-text ss-flex"},{default:n((()=>[i(l)(U.selectedSku)?_("",!0):(c(),u(a,{key:0,src:i(f).$url.static("/static/img/shop/goods/score1.svg"),class:"point-img"},null,8,["src"])),d(C,{class:"point-text ss-m-r-16"},{default:n((()=>[p(m(F.value),1)])),_:1})])),_:1})):(c(),u(O,{key:1,class:"price-text"},{default:n((()=>[p(" ￥"+m(i(I)(U.selectedSku.price||U.goodsInfo.price)),1)])),_:1})),d(O,{class:"tig ss-flex ss-col-center"},{default:n((()=>[d(O,{class:"tig-icon ss-flex ss-col-center ss-row-center"},{default:n((()=>[d(C,{class:"cicon-alarm"})])),_:1}),d(O,{class:"tig-title"},{default:n((()=>[p("秒杀价")])),_:1})])),_:1}),d(O,{class:"stock-text ss-m-l-20"},{default:n((()=>[p(" 库存"+m(U.selectedSku.stock||U.goodsInfo.stock)+"件 ",1)])),_:1})])),_:1})])),_:1})])),_:1}),d(O,{class:"modal-content ss-flex-1"},{default:n((()=>[d(B,{"scroll-y":"true",class:"modal-content-scroll"},{default:n((()=>[(c(!0),k(b,null,x(i(G),(e=>(c(),u(O,{class:"sku-item ss-m-b-20",key:e.id},{default:n((()=>[d(O,{class:"label-text ss-m-b-20"},{default:n((()=>[p(m(e.name),1)])),_:2},1024),d(O,{class:"ss-flex ss-col-center ss-flex-wrap"},{default:n((()=>[(c(!0),k(b,null,x(e.values,(s=>(c(),u(V,{class:g(["ss-reset-button spec-btn",[{"checked-btn":U.currentPropertyArray[e.id]===s.id},{"disabled-btn":!0===s.disabled}]]),key:s.id,disabled:!0===s.disabled,onClick:t=>((e,s)=>{let t=!0;void 0!==U.currentPropertyArray[e]&&U.currentPropertyArray[e]===s?(t=!1,U.currentPropertyArray.splice(e,1,"")):U.currentPropertyArray[e]=s;let l=[];Object.entries(U.currentPropertyArray).forEach((([e,s])=>{""!==s&&l.push(s)}));let a=z();l.length===G.length&&a.length?(a[0].count=U.selectedSku.count||1,U.selectedSku=a[0]):U.selectedSku={},q(t,e,s)})(e.id,s.id)},{default:n((()=>[p(m(s.name),1)])),_:2},1032,["class","disabled","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)),d(O,{class:"buy-num-box ss-flex ss-col-center ss-row-between"},{default:n((()=>[d(O,{class:"label-text"},{default:n((()=>[p("购买数量")])),_:1}),d(L,{min:1,max:i(E)([e.singleLimitCount,U.selectedSku.stock]),step:1,modelValue:U.selectedSku.count,"onUpdate:modelValue":t[0]||(t[0]=e=>U.selectedSku.count=e),onChange:t[1]||(t[1]=e=>{var s;(s=e)>0&&U.selectedSku.count!==s&&(U.selectedSku.count=s)}),activity:"seckill"},null,8,["max","modelValue"])])),_:1})])),_:1})])),_:1}),d(O,{class:"modal-footer"},{default:n((()=>[d(O,{class:"buy-box ss-flex ss-col-center ss-flex ss-col-center ss-row-center"},{default:n((()=>[d(V,{class:"ss-reset-button buy-btn",onClick:N},{default:n((()=>[p("确认")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-b0dab061"]]);export{U as _,E as m};
